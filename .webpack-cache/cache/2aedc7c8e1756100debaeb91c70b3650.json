{"remainingRequest":"/wiki/node_modules/babel-loader/lib/index.js??ref--0-1!/wiki/node_modules/vue-loader/lib/index.js??vue-loader-options!/wiki/client/components/editor/editor-markdown.vue?vue&type=script&lang=js&","dependencies":[{"path":"/wiki/client/components/editor/editor-markdown.vue","mtime":1742087243697},{"path":"/wiki/.babelrc","mtime":1738531012000},{"path":"/wiki/node_modules/cache-loader/dist/cjs.js","mtime":1742050731325},{"path":"/wiki/node_modules/babel-loader/lib/index.js","mtime":1742050728516},{"path":"/wiki/node_modules/vue-loader/lib/index.js","mtime":1742050864669}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0IF9zZXQgZnJvbSAibG9kYXNoL3NldCI7CmltcG9ydCBfZmluZExhc3QgZnJvbSAibG9kYXNoL2ZpbmRMYXN0IjsKaW1wb3J0IF9sYXN0IGZyb20gImxvZGFzaC9sYXN0IjsKaW1wb3J0IF9mbGF0dGVuIGZyb20gImxvZGFzaC9mbGF0dGVuIjsKaW1wb3J0IF9nZXQgZnJvbSAibG9kYXNoL2dldCI7CmltcG9ydCBfdGltZXMgZnJvbSAibG9kYXNoL3RpbWVzIjsKaW1wb3J0IF9zdGFydHNXaXRoIGZyb20gImxvZGFzaC9zdGFydHNXaXRoIjsKaW1wb3J0IF9kZWJvdW5jZSBmcm9tICJsb2Rhc2gvZGVib3VuY2UiOwppbXBvcnQgX2VzY2FwZSBmcm9tICJsb2Rhc2gvZXNjYXBlIjsKaW1wb3J0IHsgZ2V0LCBzeW5jIH0gZnJvbSAndnVleC1wYXRoaWZ5JzsKaW1wb3J0IG1hcmtkb3duSGVscCBmcm9tICcuL21hcmtkb3duL2hlbHAudnVlJzsKaW1wb3J0IERPTVB1cmlmeSBmcm9tICdkb21wdXJpZnknOwovKiBnbG9iYWwgc2l0ZUNvbmZpZywgc2l0ZUxhbmdzICovCi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KLy8gSU1QT1JUUwovLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09Ci8vIENvZGUgTWlycm9yCgppbXBvcnQgQ29kZU1pcnJvciBmcm9tICdjb2RlbWlycm9yJzsKaW1wb3J0ICdjb2RlbWlycm9yL2xpYi9jb2RlbWlycm9yLmNzcyc7IC8vIExhbmd1YWdlCgppbXBvcnQgJ2NvZGVtaXJyb3IvbW9kZS9tYXJrZG93bi9tYXJrZG93bi5qcyc7IC8vIEFkZG9ucwoKaW1wb3J0ICdjb2RlbWlycm9yL2FkZG9uL3NlbGVjdGlvbi9hY3RpdmUtbGluZS5qcyc7CmltcG9ydCAnY29kZW1pcnJvci9hZGRvbi9kaXNwbGF5L2Z1bGxzY3JlZW4uanMnOwppbXBvcnQgJ2NvZGVtaXJyb3IvYWRkb24vZGlzcGxheS9mdWxsc2NyZWVuLmNzcyc7CmltcG9ydCAnY29kZW1pcnJvci9hZGRvbi9zZWxlY3Rpb24vbWFyay1zZWxlY3Rpb24uanMnOwppbXBvcnQgJ2NvZGVtaXJyb3IvYWRkb24vc2VhcmNoL3NlYXJjaGN1cnNvci5qcyc7CmltcG9ydCAnY29kZW1pcnJvci9hZGRvbi9oaW50L3Nob3ctaGludC5qcyc7CmltcG9ydCAnY29kZW1pcnJvci9hZGRvbi9mb2xkL2ZvbGRjb2RlLmpzJzsKaW1wb3J0ICdjb2RlbWlycm9yL2FkZG9uL2ZvbGQvZm9sZGd1dHRlci5qcyc7CmltcG9ydCAnY29kZW1pcnJvci9hZGRvbi9mb2xkL2ZvbGRndXR0ZXIuY3NzJzsgLy8gTWFya2Rvd24taXQKCmltcG9ydCBNYXJrZG93bkl0IGZyb20gJ21hcmtkb3duLWl0JzsKaW1wb3J0IG1kQXR0cnMgZnJvbSAnbWFya2Rvd24taXQtYXR0cnMnOwppbXBvcnQgbWREZWNvcmF0ZSBmcm9tICdtYXJrZG93bi1pdC1kZWNvcmF0ZSc7CmltcG9ydCB7IGZ1bGwgYXMgbWRFbW9qaSB9IGZyb20gJ21hcmtkb3duLWl0LWVtb2ppJzsKaW1wb3J0IG1kVGFza0xpc3RzIGZyb20gJ21hcmtkb3duLWl0LXRhc2stbGlzdHMnOwppbXBvcnQgbWRFeHBhbmRUYWJzIGZyb20gJ21hcmtkb3duLWl0LWV4cGFuZC10YWJzJzsKaW1wb3J0IG1kQWJiciBmcm9tICdtYXJrZG93bi1pdC1hYmJyJzsKaW1wb3J0IG1kU3VwIGZyb20gJ21hcmtkb3duLWl0LXN1cCc7CmltcG9ydCBtZFN1YiBmcm9tICdtYXJrZG93bi1pdC1zdWInOwppbXBvcnQgbWRNYXJrIGZyb20gJ21hcmtkb3duLWl0LW1hcmsnOwppbXBvcnQgbWRNdWx0aVRhYmxlIGZyb20gJ21hcmtkb3duLWl0LW11bHRpbWQtdGFibGUnOwppbXBvcnQgbWRGb290bm90ZSBmcm9tICdtYXJrZG93bi1pdC1mb290bm90ZSc7CmltcG9ydCBtZEltc2l6ZSBmcm9tICdtYXJrZG93bi1pdC1pbXNpemUnOwppbXBvcnQga2F0ZXggZnJvbSAna2F0ZXgnOwppbXBvcnQgdW5kZXJsaW5lIGZyb20gJy4uLy4uL2xpYnMvbWFya2Rvd24taXQtdW5kZXJsaW5lJzsKaW1wb3J0ICdrYXRleC9kaXN0L2NvbnRyaWIvbWhjaGVtJzsKaW1wb3J0IHR3ZW1vamkgZnJvbSAndHdlbW9qaSc7CmltcG9ydCBwbGFudHVtbCBmcm9tICcuL21hcmtkb3duL3BsYW50dW1sJzsgLy8gUHJpc20gKFN5bnRheCBIaWdobGlnaHRpbmcpCgppbXBvcnQgUHJpc20gZnJvbSAicHJpc21qcy9jb21wb25lbnRzL3ByaXNtLWNvcmUiOyAvLyBNZXJtYWlkCgppbXBvcnQgInByaXNtanMvY29tcG9uZW50cy9wcmlzbS1jbGlrZSI7CmltcG9ydCAicHJpc21qcy9jb21wb25lbnRzL3ByaXNtLW1hcmt1cCI7CmltcG9ydCAicHJpc21qcy9wbHVnaW5zL2xpbmUtbnVtYmVycy9wcmlzbS1saW5lLW51bWJlcnMuY3NzIjsKaW1wb3J0ICJwcmlzbWpzL3BsdWdpbnMvbGluZS1udW1iZXJzL3ByaXNtLWxpbmUtbnVtYmVycyI7CmltcG9ydCAicHJpc21qcy9wbHVnaW5zL2F1dG9sb2FkZXIvcHJpc20tYXV0b2xvYWRlciI7CmltcG9ydCAicHJpc21qcy9wbHVnaW5zL25vcm1hbGl6ZS13aGl0ZXNwYWNlL3ByaXNtLW5vcm1hbGl6ZS13aGl0ZXNwYWNlIjsKaW1wb3J0ICJwcmlzbWpzL3BsdWdpbnMvdG9vbGJhci9wcmlzbS10b29sYmFyLmNzcyI7CmltcG9ydCAicHJpc21qcy9wbHVnaW5zL3Rvb2xiYXIvcHJpc20tdG9vbGJhciI7CmltcG9ydCAicHJpc21qcy9wbHVnaW5zL2NvcHktdG8tY2xpcGJvYXJkL3ByaXNtLWNvcHktdG8tY2xpcGJvYXJkIjsKaW1wb3J0ICJwcmlzbWpzL3RoZW1lcy9wcmlzbS10d2lsaWdodC5jc3MiOwppbXBvcnQgbWVybWFpZCBmcm9tICdtZXJtYWlkJzsgLy8gSGVscGVycwoKaW1wb3J0IGthdGV4SGVscGVyIGZyb20gJy4vY29tbW9uL2thdGV4JzsKaW1wb3J0IHRhYnNldEhlbHBlciBmcm9tICcuL21hcmtkb3duL3RhYnNldCc7CmltcG9ydCBjbUZvbGQgZnJvbSAnLi9jb21tb24vY21Gb2xkJzsgLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQovLyBJTklUCi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KLy8gUGxhdGZvcm0gZGV0ZWN0aW9uCgpjb25zdCBDdHJsS2V5ID0gL01hYy8udGVzdChuYXZpZ2F0b3IucGxhdGZvcm0pID8gJ0NtZCcgOiAnQ3RybCc7IC8vIFByaXNtIENvbmZpZwoKUHJpc20ucGx1Z2lucy5hdXRvbG9hZGVyLmxhbmd1YWdlc19wYXRoID0gJy9fYXNzZXRzL2pzL3ByaXNtLyc7ClByaXNtLnBsdWdpbnMuTm9ybWFsaXplV2hpdGVzcGFjZS5zZXREZWZhdWx0cyh7CiAgJ3JlbW92ZS10cmFpbGluZyc6IHRydWUsCiAgJ3JlbW92ZS1pbmRlbnQnOiB0cnVlLAogICdsZWZ0LXRyaW0nOiB0cnVlLAogICdyaWdodC10cmltJzogdHJ1ZSwKICAncmVtb3ZlLWluaXRpYWwtbGluZS1mZWVkJzogdHJ1ZSwKICAndGFicy10by1zcGFjZXMnOiAyCn0pOyAvLyBNYXJrZG93biBJbnN0YW5jZQoKY29uc3QgbWQgPSBuZXcgTWFya2Rvd25JdCh7CiAgaHRtbDogdHJ1ZSwKICBicmVha3M6IHRydWUsCiAgbGlua2lmeTogdHJ1ZSwKICB0eXBvZ3JhcGh5OiB0cnVlLAoKICBoaWdobGlnaHQoc3RyLCBsYW5nKSB7CiAgICBpZiAobGFuZyA9PT0gJ2RpYWdyYW0nKSB7CiAgICAgIHJldHVybiBgPHByZSBjbGFzcz0iZGlhZ3JhbSI+YCArIEJ1ZmZlci5mcm9tKHN0ciwgJ2Jhc2U2NCcpLnRvU3RyaW5nKCkgKyBgPC9wcmU+YDsKICAgIH0gZWxzZSBpZiAoWydtZXJtYWlkJywgJ3BsYW50dW1sJ10uaW5jbHVkZXMobGFuZykpIHsKICAgICAgcmV0dXJuIGA8cHJlIGNsYXNzPSJjb2RlYmxvY2stJHtsYW5nfSI+PGNvZGU+JHtfZXNjYXBlKHN0cil9PC9jb2RlPjwvcHJlPmA7CiAgICB9IGVsc2UgewogICAgICByZXR1cm4gYDxwcmUgY2xhc3M9ImxpbmUtbnVtYmVycyI+PGNvZGUgY2xhc3M9Imxhbmd1YWdlLSR7bGFuZ30iPiR7X2VzY2FwZShzdHIpfTwvY29kZT48L3ByZT5gOwogICAgfQogIH0KCn0pIC8vIFRPRE86IHNvbWUgaG93IHJlYWQgdGhlIGNvbmZpZyBmcm9tIGJhY2tlbmQ/Ci8vIC51c2UobWRBdHRycywgewovLyAgIGFsbG93ZWRBdHRyaWJ1dGVzOiBbJ2lkJywgJ2NsYXNzJywgJ3RhcmdldCddCi8vIH0pCi51c2UobWREZWNvcmF0ZSkudXNlKHVuZGVybGluZSkudXNlKG1kRW1vamkpLnVzZShtZFRhc2tMaXN0cywgewogIGxhYmVsOiBmYWxzZSwKICBsYWJlbEFmdGVyOiBmYWxzZQp9KS51c2UobWRFeHBhbmRUYWJzKS51c2UobWRBYmJyKS51c2UobWRTdXApLnVzZShtZFN1YikudXNlKG1kTXVsdGlUYWJsZSwgewogIG11bHRpbGluZTogdHJ1ZSwKICByb3dzcGFuOiB0cnVlLAogIGhlYWRlcmxlc3M6IHRydWUKfSkudXNlKG1kTWFyaykudXNlKG1kRm9vdG5vdGUpLnVzZShtZEltc2l6ZSk7IC8vIERPTVB1cmlmeSBmaXggZm9yIGRyYXcuaW8KCkRPTVB1cmlmeS5hZGRIb29rKCd1cG9uU2FuaXRpemVFbGVtZW50JywgZWxtID0+IHsKICBpZiAoZWxtLnF1ZXJ5U2VsZWN0b3JBbGwpIHsKICAgIGNvbnN0IGJyZWFrcyA9IGVsbS5xdWVyeVNlbGVjdG9yQWxsKCdmb3JlaWduT2JqZWN0IGJyLCBmb3JlaWduT2JqZWN0IHAnKTsKCiAgICBpZiAoYnJlYWtzICYmIGJyZWFrcy5sZW5ndGgpIHsKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBicmVha3MubGVuZ3RoOyBpKyspIHsKICAgICAgICBicmVha3NbaV0ucGFyZW50Tm9kZS5yZXBsYWNlQ2hpbGQoZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2JyksIGJyZWFrc1tpXSk7CiAgICAgIH0KICAgIH0KICB9Cn0pOyAvLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09Ci8vIEhFTFBFUiBGVU5DVElPTlMKLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQovLyBJbmplY3QgbGluZSBudW1iZXJzIGZvciBwcmV2aWV3IHNjcm9sbCBzeW5jCgpsZXQgbGluZXNNYXAgPSBbXTsKCmZ1bmN0aW9uIGluamVjdExpbmVOdW1iZXJzKHRva2VucywgaWR4LCBvcHRpb25zLCBlbnYsIHNsZikgewogIGxldCBsaW5lOwoKICBpZiAodG9rZW5zW2lkeF0ubWFwICYmIHRva2Vuc1tpZHhdLmxldmVsID09PSAwKSB7CiAgICBsaW5lID0gdG9rZW5zW2lkeF0ubWFwWzBdOwogICAgdG9rZW5zW2lkeF0uYXR0ckpvaW4oJ2NsYXNzJywgJ2xpbmUnKTsKICAgIHRva2Vuc1tpZHhdLmF0dHJTZXQoJ2RhdGEtbGluZScsIFN0cmluZyhsaW5lKSk7CiAgICBsaW5lc01hcC5wdXNoKGxpbmUpOwogIH0KCiAgcmV0dXJuIHNsZi5yZW5kZXJUb2tlbih0b2tlbnMsIGlkeCwgb3B0aW9ucywgZW52LCBzbGYpOwp9CgptZC5yZW5kZXJlci5ydWxlcy5wYXJhZ3JhcGhfb3BlbiA9IGluamVjdExpbmVOdW1iZXJzOwptZC5yZW5kZXJlci5ydWxlcy5oZWFkaW5nX29wZW4gPSBpbmplY3RMaW5lTnVtYmVyczsKbWQucmVuZGVyZXIucnVsZXMuYmxvY2txdW90ZV9vcGVuID0gaW5qZWN0TGluZU51bWJlcnM7CmNtRm9sZC5yZWdpc3RlcignbWFya2Rvd24nKTsgLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQovLyBQTEFOVFVNTAovLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09Ci8vIFRPRE86IFVzZSBzYW1lIG9wdGlvbnMgYXMgZGVmaW5lZCBpbiBiYWNrZW5kCgpwbGFudHVtbC5pbml0KG1kLCB7fSk7IC8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KLy8gS0FURVgKLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQoKY29uc3QgbWFjcm9zID0ge307Cm1kLmlubGluZS5ydWxlci5hZnRlcignZXNjYXBlJywgJ2thdGV4X2lubGluZScsIGthdGV4SGVscGVyLmthdGV4SW5saW5lKTsKCm1kLnJlbmRlcmVyLnJ1bGVzLmthdGV4X2lubGluZSA9ICh0b2tlbnMsIGlkeCkgPT4gewogIHRyeSB7CiAgICByZXR1cm4ga2F0ZXgucmVuZGVyVG9TdHJpbmcodG9rZW5zW2lkeF0uY29udGVudCwgewogICAgICBkaXNwbGF5TW9kZTogZmFsc2UsCiAgICAgIG1hY3JvcwogICAgfSk7CiAgfSBjYXRjaCAoZXJyKSB7CiAgICBjb25zb2xlLndhcm4oZXJyKTsKICAgIHJldHVybiB0b2tlbnNbaWR4XS5jb250ZW50OwogIH0KfTsKCm1kLmJsb2NrLnJ1bGVyLmFmdGVyKCdibG9ja3F1b3RlJywgJ2thdGV4X2Jsb2NrJywga2F0ZXhIZWxwZXIua2F0ZXhCbG9jaywgewogIGFsdDogWydwYXJhZ3JhcGgnLCAncmVmZXJlbmNlJywgJ2Jsb2NrcXVvdGUnLCAnbGlzdCddCn0pOwoKbWQucmVuZGVyZXIucnVsZXMua2F0ZXhfYmxvY2sgPSAodG9rZW5zLCBpZHgpID0+IHsKICB0cnkgewogICAgcmV0dXJuIGA8cD5gICsga2F0ZXgucmVuZGVyVG9TdHJpbmcodG9rZW5zW2lkeF0uY29udGVudCwgewogICAgICBkaXNwbGF5TW9kZTogdHJ1ZSwKICAgICAgbWFjcm9zCiAgICB9KSArIGA8L3A+YDsKICB9IGNhdGNoIChlcnIpIHsKICAgIGNvbnNvbGUud2FybihlcnIpOwogICAgcmV0dXJuIHRva2Vuc1tpZHhdLmNvbnRlbnQ7CiAgfQp9OyAvLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09Ci8vIFRXRU1PSkkKLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQoKCm1kLnJlbmRlcmVyLnJ1bGVzLmVtb2ppID0gKHRva2VuLCBpZHgpID0+IHsKICByZXR1cm4gdHdlbW9qaS5wYXJzZSh0b2tlbltpZHhdLmNvbnRlbnQsIHsKICAgIGNhbGxiYWNrKGljb24sIG9wdHMpIHsKICAgICAgcmV0dXJuIGAvX2Fzc2V0cy9zdmcvdHdlbW9qaS8ke2ljb259LnN2Z2A7CiAgICB9CgogIH0pOwp9OyAvLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09Ci8vIFZ1ZSBDb21wb25lbnQKLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQoKCmxldCBtZXJtYWlkSWQgPSAwOwpleHBvcnQgZGVmYXVsdCB7CiAgY29tcG9uZW50czogewogICAgbWFya2Rvd25IZWxwCiAgfSwKICBwcm9wczogewogICAgc2F2ZTogewogICAgICB0eXBlOiBGdW5jdGlvbiwKICAgICAgZGVmYXVsdDogKCkgPT4ge30KICAgIH0KICB9LAoKICBkYXRhKCkgewogICAgcmV0dXJuIHsKICAgICAgZmFiSW5zZXJ0TWVudTogZmFsc2UsCiAgICAgIGNtOiBudWxsLAogICAgICBjdXJzb3JQb3M6IHsKICAgICAgICBjaDogMCwKICAgICAgICBsaW5lOiAxCiAgICAgIH0sCiAgICAgIHByZXZpZXdTaG93bjogdHJ1ZSwKICAgICAgcHJldmlld0hUTUw6ICcnLAogICAgICBoZWxwU2hvd246IGZhbHNlLAogICAgICBzcGVsbE1vZGVBY3RpdmU6IGZhbHNlLAogICAgICBpbnNlcnRMaW5rRGlhbG9nOiBmYWxzZQogICAgfTsKICB9LAoKICBjb21wdXRlZDogewogICAgaXNNb2JpbGUoKSB7CiAgICAgIHJldHVybiB0aGlzLiR2dWV0aWZ5LmJyZWFrcG9pbnQuc21BbmREb3duOwogICAgfSwKCiAgICBpc01vZGFsU2hvd24oKSB7CiAgICAgIHJldHVybiB0aGlzLmhlbHBTaG93biB8fCB0aGlzLmFjdGl2ZU1vZGFsICE9PSAnJzsKICAgIH0sCgogICAgbG9jYWxlOiBnZXQoJ3BhZ2UvbG9jYWxlJyksCiAgICBwYXRoOiBnZXQoJ3BhZ2UvcGF0aCcpLAogICAgbW9kZTogZ2V0KCdlZGl0b3IvbW9kZScpLAogICAgYWN0aXZlTW9kYWw6IHN5bmMoJ2VkaXRvci9hY3RpdmVNb2RhbCcpCiAgfSwKICB3YXRjaDogewogICAgcHJldmlld1Nob3duKG5ld1ZhbHVlLCBvbGRWYWx1ZSkgewogICAgICBpZiAobmV3VmFsdWUgJiYgIW9sZFZhbHVlKSB7CiAgICAgICAgdGhpcy4kbmV4dFRpY2soKCkgPT4gewogICAgICAgICAgdGhpcy5yZW5kZXJNZXJtYWlkRGlhZ3JhbXMoKTsKICAgICAgICAgIFByaXNtLmhpZ2hsaWdodEFsbFVuZGVyKHRoaXMuJHJlZnMuZWRpdG9yUHJldmlldyk7CiAgICAgICAgICBBcnJheS5mcm9tKHRoaXMuJHJlZnMuZWRpdG9yUHJldmlldy5xdWVyeVNlbGVjdG9yQWxsKCdwcmUubGluZS1udW1iZXJzJykpLmZvckVhY2gocHJlID0+IHByZS5jbGFzc0xpc3QuYWRkKCdwcmlzbWpzJykpOwogICAgICAgIH0pOwogICAgICB9CiAgICB9LAoKICAgIHNwZWxsTW9kZUFjdGl2ZShuZXdWYWx1ZSwgb2xkVmFsdWUpIHsKICAgICAgaWYgKG5ld1ZhbHVlKSB7CiAgICAgICAgdGhpcy4kbmV4dFRpY2soKCkgPT4gewogICAgICAgICAgdGhpcy4kcmVmcy5lZGl0b3JQcmV2aWV3LmZvY3VzKCk7CiAgICAgICAgfSk7CiAgICAgIH0KICAgIH0KCiAgfSwKICBtZXRob2RzOiB7CiAgICB0b2dnbGVNb2RhbChrZXkpIHsKICAgICAgdGhpcy5hY3RpdmVNb2RhbCA9IHRoaXMuYWN0aXZlTW9kYWwgPT09IGtleSA/ICcnIDoga2V5OwogICAgICB0aGlzLmhlbHBTaG93biA9IGZhbHNlOwogICAgfSwKCiAgICBjbG9zZUFsbE1vZGFsKCkgewogICAgICB0aGlzLmFjdGl2ZU1vZGFsID0gJyc7CiAgICAgIHRoaXMuaGVscFNob3duID0gZmFsc2U7CiAgICB9LAoKICAgIG9uQ21JbnB1dDogX2RlYm91bmNlKGZ1bmN0aW9uIChuZXdDb250ZW50KSB7CiAgICAgIHRoaXMucHJvY2Vzc0NvbnRlbnQobmV3Q29udGVudCk7CiAgICB9LCA2MDApLAoKICAgIG9uQ21QYXN0ZShjbSwgZXYpIHsvLyBjb25zdCBjbGlwSXRlbXMgPSAoZXYuY2xpcGJvYXJkRGF0YSB8fCBldi5vcmlnaW5hbEV2ZW50LmNsaXBib2FyZERhdGEpLml0ZW1zCiAgICAgIC8vIGZvciAobGV0IGNsaXBJdGVtIG9mIGNsaXBJdGVtcykgewogICAgICAvLyAgIGlmIChfLnN0YXJ0c1dpdGgoY2xpcEl0ZW0udHlwZSwgJ2ltYWdlLycpKSB7CiAgICAgIC8vICAgICBjb25zdCBmaWxlID0gY2xpcEl0ZW0uZ2V0QXNGaWxlKCkKICAgICAgLy8gICAgIGNvbnN0IHJlYWRlciA9IG5ldyBGaWxlUmVhZGVyKCkKICAgICAgLy8gICAgIHJlYWRlci5vbmxvYWQgPSBldnQgPT4gewogICAgICAvLyAgICAgICB0aGlzLiRzdG9yZS5jb21taXQoYGxvYWRpbmdTdGFydGAsICdlZGl0b3ItcGFzdGUtaW1hZ2UnKQogICAgICAvLyAgICAgICB0aGlzLmluc2VydEFmdGVyKHsKICAgICAgLy8gICAgICAgICBjb250ZW50OiBgIVske2ZpbGUubmFtZX1dKCR7ZXZ0LnRhcmdldC5yZXN1bHR9KWAsCiAgICAgIC8vICAgICAgICAgbmV3TGluZTogdHJ1ZQogICAgICAvLyAgICAgICB9KQogICAgICAvLyAgICAgfQogICAgICAvLyAgICAgcmVhZGVyLnJlYWRBc0RhdGFVUkwoZmlsZSkKICAgICAgLy8gICB9CiAgICAgIC8vIH0KICAgIH0sCgogICAgcHJvY2Vzc0NvbnRlbnQobmV3Q29udGVudCkgewogICAgICBsaW5lc01hcCA9IFtdOyAvLyB0aGlzLiRzdG9yZS5zZXQoJ2VkaXRvci9jb250ZW50JywgbmV3Q29udGVudCkKCiAgICAgIHRoaXMucHJvY2Vzc01hcmtlcnModGhpcy5jbS5maXJzdExpbmUoKSwgdGhpcy5jbS5sYXN0TGluZSgpKTsKICAgICAgdGhpcy5wcmV2aWV3SFRNTCA9IERPTVB1cmlmeS5zYW5pdGl6ZShtZC5yZW5kZXIobmV3Q29udGVudCksIHsKICAgICAgICBBRERfVEFHUzogWydmb3JlaWduT2JqZWN0J10KICAgICAgfSk7CiAgICAgIHRoaXMuJG5leHRUaWNrKCgpID0+IHsKICAgICAgICB0YWJzZXRIZWxwZXIuZm9ybWF0KCk7CiAgICAgICAgdGhpcy5yZW5kZXJNZXJtYWlkRGlhZ3JhbXMoKTsKICAgICAgICBQcmlzbS5oaWdobGlnaHRBbGxVbmRlcih0aGlzLiRyZWZzLmVkaXRvclByZXZpZXcpOwogICAgICAgIEFycmF5LmZyb20odGhpcy4kcmVmcy5lZGl0b3JQcmV2aWV3LnF1ZXJ5U2VsZWN0b3JBbGwoJ3ByZS5saW5lLW51bWJlcnMnKSkuZm9yRWFjaChwcmUgPT4gcHJlLmNsYXNzTGlzdC5hZGQoJ3ByaXNtanMnKSk7CiAgICAgICAgdGhpcy5zY3JvbGxTeW5jKHRoaXMuY20pOwogICAgICB9KTsKICAgIH0sCgogICAgLyoqCiAgICAgKiBVcGRhdGUgY3Vyc29yIHN0YXRlCiAgICAgKi8KICAgIHBvc2l0aW9uU3luYyhjbSkgewogICAgICB0aGlzLmN1cnNvclBvcyA9IGNtLmdldEN1cnNvcignaGVhZCcpOwogICAgfSwKCiAgICAvKioKICAgICAqIFdyYXAgc2VsZWN0aW9uIHdpdGggc3RhcnQgLyBlbmQgdGFncwogICAgICovCiAgICB0b2dnbGVNYXJrdXAoewogICAgICBzdGFydCwKICAgICAgZW5kCiAgICB9KSB7CiAgICAgIGlmICghZW5kKSB7CiAgICAgICAgZW5kID0gc3RhcnQ7CiAgICAgIH0KCiAgICAgIGlmICghdGhpcy5jbS5kb2Muc29tZXRoaW5nU2VsZWN0ZWQoKSkgewogICAgICAgIHJldHVybiB0aGlzLiRzdG9yZS5jb21taXQoJ3Nob3dOb3RpZmljYXRpb24nLCB7CiAgICAgICAgICBtZXNzYWdlOiB0aGlzLiR0KCdlZGl0b3I6bWFya3VwLm5vU2VsZWN0aW9uRXJyb3InKSwKICAgICAgICAgIHN0eWxlOiAnd2FybmluZycsCiAgICAgICAgICBpY29uOiAnd2FybmluZycKICAgICAgICB9KTsKICAgICAgfQoKICAgICAgdGhpcy5jbS5kb2MucmVwbGFjZVNlbGVjdGlvbnModGhpcy5jbS5kb2MuZ2V0U2VsZWN0aW9ucygpLm1hcChzID0+IHN0YXJ0ICsgcyArIGVuZCkpOwogICAgfSwKCiAgICAvKioKICAgICAqIFNldCBjdXJyZW50IGxpbmUgYXMgaGVhZGVyCiAgICAgKi8KICAgIHNldEhlYWRlckxpbmUobHZsKSB7CiAgICAgIGNvbnN0IGN1ckxpbmUgPSB0aGlzLmNtLmRvYy5nZXRDdXJzb3IoJ2hlYWQnKS5saW5lOwogICAgICBsZXQgbGluZUNvbnRlbnQgPSB0aGlzLmNtLmRvYy5nZXRMaW5lKGN1ckxpbmUpOwogICAgICBjb25zdCBsaW5lTGVuZ3RoID0gbGluZUNvbnRlbnQubGVuZ3RoOwoKICAgICAgaWYgKF9zdGFydHNXaXRoKGxpbmVDb250ZW50LCAnIycpKSB7CiAgICAgICAgbGluZUNvbnRlbnQgPSBsaW5lQ29udGVudC5yZXBsYWNlKC9eKCMrICkvLCAnJyk7CiAgICAgIH0KCiAgICAgIGxpbmVDb250ZW50ID0gX3RpbWVzKGx2bCwgbiA9PiAnIycpLmpvaW4oJycpICsgYCBgICsgbGluZUNvbnRlbnQ7CiAgICAgIHRoaXMuY20uZG9jLnJlcGxhY2VSYW5nZShsaW5lQ29udGVudCwgewogICAgICAgIGxpbmU6IGN1ckxpbmUsCiAgICAgICAgY2g6IDAKICAgICAgfSwgewogICAgICAgIGxpbmU6IGN1ckxpbmUsCiAgICAgICAgY2g6IGxpbmVMZW5ndGgKICAgICAgfSk7CiAgICB9LAoKICAgIC8qKgogICAgICogR2V0IHRoZSBoZWFkZXIgbGV2ZXIgb2YgdGhlIGN1cnJlbnQgbGluZQogICAgICovCiAgICBnZXRIZWFkZXJMZXZlbChjbSkgewogICAgICBjb25zdCBjdXJMaW5lID0gdGhpcy5jbS5kb2MuZ2V0Q3Vyc29yKCdoZWFkJykubGluZTsKICAgICAgbGV0IGxpbmVDb250ZW50ID0gdGhpcy5jbS5kb2MuZ2V0TGluZShjdXJMaW5lKTsKICAgICAgbGV0IGx2bCA9IDA7CiAgICAgIGNvbnN0IHJlc3VsdCA9IGxpbmVDb250ZW50Lm1hdGNoKC9eKCMrKSAvKTsKCiAgICAgIGlmIChyZXN1bHQpIHsKICAgICAgICBsdmwgPSBfZ2V0KHJlc3VsdCwgJ1sxXScsICcnKS5sZW5ndGg7CiAgICAgIH0KCiAgICAgIHJldHVybiBsdmw7CiAgICB9LAoKICAgIC8qKgogICAgICogSW5zZXJ0IGNvbnRlbnQgYXQgY3Vyc29yCiAgICAgKi8KICAgIGluc2VydEF0Q3Vyc29yKHsKICAgICAgY29udGVudAogICAgfSkgewogICAgICBjb25zdCBjdXJzb3IgPSB0aGlzLmNtLmRvYy5nZXRDdXJzb3IoJ2hlYWQnKTsKICAgICAgdGhpcy5jbS5kb2MucmVwbGFjZVJhbmdlKGNvbnRlbnQsIGN1cnNvcik7CiAgICB9LAoKICAgIC8qKgogICAgICogSW5zZXJ0IGNvbnRlbnQgYWZ0ZXIgY3VycmVudCBsaW5lCiAgICAgKi8KICAgIGluc2VydEFmdGVyKHsKICAgICAgY29udGVudCwKICAgICAgbmV3TGluZQogICAgfSkgewogICAgICBjb25zdCBjdXJMaW5lID0gdGhpcy5jbS5kb2MuZ2V0Q3Vyc29yKCd0bycpLmxpbmU7CiAgICAgIGNvbnN0IGxpbmVMZW5ndGggPSB0aGlzLmNtLmRvYy5nZXRMaW5lKGN1ckxpbmUpLmxlbmd0aDsKICAgICAgdGhpcy5jbS5kb2MucmVwbGFjZVJhbmdlKG5ld0xpbmUgPyBgXG4ke2NvbnRlbnR9XG5gIDogY29udGVudCwgewogICAgICAgIGxpbmU6IGN1ckxpbmUsCiAgICAgICAgY2g6IGxpbmVMZW5ndGggKyAxCiAgICAgIH0pOwogICAgfSwKCiAgICAvKioKICAgICAqIEluc2VydCBjb250ZW50IGJlZm9yZSBjdXJyZW50IGxpbmUKICAgICAqLwogICAgaW5zZXJ0QmVmb3JlRWFjaExpbmUoewogICAgICBjb250ZW50LAogICAgICBhZnRlcgogICAgfSkgewogICAgICBsZXQgbGluZXMgPSBbXTsKCiAgICAgIGlmICghdGhpcy5jbS5kb2Muc29tZXRoaW5nU2VsZWN0ZWQoKSkgewogICAgICAgIGxpbmVzLnB1c2godGhpcy5jbS5kb2MuZ2V0Q3Vyc29yKCdoZWFkJykubGluZSk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgbGluZXMgPSBfZmxhdHRlbih0aGlzLmNtLmRvYy5saXN0U2VsZWN0aW9ucygpLm1hcChzbCA9PiB7CiAgICAgICAgICBjb25zdCByYW5nZSA9IE1hdGguYWJzKHNsLmFuY2hvci5saW5lIC0gc2wuaGVhZC5saW5lKSArIDE7CiAgICAgICAgICBjb25zdCBsb3dlc3RMaW5lID0gc2wuYW5jaG9yLmxpbmUgPiBzbC5oZWFkLmxpbmUgPyBzbC5oZWFkLmxpbmUgOiBzbC5hbmNob3IubGluZTsKICAgICAgICAgIHJldHVybiBfdGltZXMocmFuZ2UsIGwgPT4gbCArIGxvd2VzdExpbmUpOwogICAgICAgIH0pKTsKICAgICAgfQoKICAgICAgbGluZXMuZm9yRWFjaChsbiA9PiB7CiAgICAgICAgbGV0IGxpbmVDb250ZW50ID0gdGhpcy5jbS5kb2MuZ2V0TGluZShsbik7CiAgICAgICAgY29uc3QgbGluZUxlbmd0aCA9IGxpbmVDb250ZW50Lmxlbmd0aDsKCiAgICAgICAgaWYgKF9zdGFydHNXaXRoKGxpbmVDb250ZW50LCBjb250ZW50KSkgewogICAgICAgICAgbGluZUNvbnRlbnQgPSBsaW5lQ29udGVudC5zdWJzdHJpbmcoY29udGVudC5sZW5ndGgpOwogICAgICAgIH0KCiAgICAgICAgdGhpcy5jbS5kb2MucmVwbGFjZVJhbmdlKGNvbnRlbnQgKyBsaW5lQ29udGVudCwgewogICAgICAgICAgbGluZTogbG4sCiAgICAgICAgICBjaDogMAogICAgICAgIH0sIHsKICAgICAgICAgIGxpbmU6IGxuLAogICAgICAgICAgY2g6IGxpbmVMZW5ndGgKICAgICAgICB9KTsKICAgICAgfSk7CgogICAgICBpZiAoYWZ0ZXIpIHsKICAgICAgICBjb25zdCBsYXN0TGluZSA9IF9sYXN0KGxpbmVzKTsKCiAgICAgICAgdGhpcy5jbS5kb2MucmVwbGFjZVJhbmdlKGBcbiR7YWZ0ZXJ9XG5gLCB7CiAgICAgICAgICBsaW5lOiBsYXN0TGluZSwKICAgICAgICAgIGNoOiB0aGlzLmNtLmRvYy5nZXRMaW5lKGxhc3RMaW5lKS5sZW5ndGggKyAxCiAgICAgICAgfSk7CiAgICAgIH0KICAgIH0sCgogICAgLyoqCiAgICAgKiBVcGRhdGUgc2Nyb2xsIHN5bmMKICAgICAqLwogICAgc2Nyb2xsU3luYzogX2RlYm91bmNlKGZ1bmN0aW9uIChjbSkgewogICAgICBpZiAoIXRoaXMucHJldmlld1Nob3duIHx8IGNtLnNvbWV0aGluZ1NlbGVjdGVkKCkpIHsKICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIGxldCBjdXJyZW50TGluZSA9IGNtLmdldEN1cnNvcigpLmxpbmU7CgogICAgICBpZiAoY3VycmVudExpbmUgPCAzKSB7CiAgICAgICAgdGhpcy5WZWxvY2l0eSh0aGlzLiRyZWZzLmVkaXRvclByZXZpZXcsICdzdG9wJywgdHJ1ZSk7CiAgICAgICAgdGhpcy5WZWxvY2l0eSh0aGlzLiRyZWZzLmVkaXRvclByZXZpZXcuZmlyc3RDaGlsZCwgJ3Njcm9sbCcsIHsKICAgICAgICAgIG9mZnNldDogJy01MCcsCiAgICAgICAgICBkdXJhdGlvbjogMTAwMCwKICAgICAgICAgIGNvbnRhaW5lcjogdGhpcy4kcmVmcy5lZGl0b3JQcmV2aWV3Q29udGFpbmVyCiAgICAgICAgfSk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgbGV0IGNsb3Nlc3RMaW5lID0gX2ZpbmRMYXN0KGxpbmVzTWFwLCBuID0+IG4gPD0gY3VycmVudExpbmUpOwoKICAgICAgICBsZXQgZGVzdEVsbSA9IHRoaXMuJHJlZnMuZWRpdG9yUHJldmlldy5xdWVyeVNlbGVjdG9yKGBbZGF0YS1saW5lPScke2Nsb3Nlc3RMaW5lfSddYCk7CgogICAgICAgIGlmIChkZXN0RWxtKSB7CiAgICAgICAgICB0aGlzLlZlbG9jaXR5KHRoaXMuJHJlZnMuZWRpdG9yUHJldmlldywgJ3N0b3AnLCB0cnVlKTsKICAgICAgICAgIHRoaXMuVmVsb2NpdHkoZGVzdEVsbSwgJ3Njcm9sbCcsIHsKICAgICAgICAgICAgb2Zmc2V0OiAnLTEwMCcsCiAgICAgICAgICAgIGR1cmF0aW9uOiAxMDAwLAogICAgICAgICAgICBjb250YWluZXI6IHRoaXMuJHJlZnMuZWRpdG9yUHJldmlld0NvbnRhaW5lcgogICAgICAgICAgfSk7CiAgICAgICAgfQogICAgICB9CiAgICB9LCA1MDApLAoKICAgIHRvZ2dsZUhlbHAoKSB7CiAgICAgIHRoaXMuaGVscFNob3duID0gIXRoaXMuaGVscFNob3duOwogICAgICB0aGlzLmFjdGl2ZU1vZGFsID0gJyc7CiAgICB9LAoKICAgIHRvZ2dsZUZ1bGxzY3JlZW4oKSB7CiAgICAgIHRoaXMuY20uc2V0T3B0aW9uKCdmdWxsU2NyZWVuJywgdHJ1ZSk7CiAgICB9LAoKICAgIHJlZnJlc2goKSB7CiAgICAgIHRoaXMuJG5leHRUaWNrKCgpID0+IHsKICAgICAgICB0aGlzLmNtLnJlZnJlc2goKTsKICAgICAgfSk7CiAgICB9LAoKICAgIHJlbmRlck1lcm1haWREaWFncmFtcygpIHsKICAgICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnLmVkaXRvci1tYXJrZG93bi1wcmV2aWV3IHByZS5jb2RlYmxvY2stbWVybWFpZCA+IGNvZGUnKS5mb3JFYWNoKGVsbSA9PiB7CiAgICAgICAgbWVybWFpZElkKys7CiAgICAgICAgY29uc3QgbWVybWFpZERlZiA9IGVsbS5pbm5lclRleHQ7CiAgICAgICAgY29uc3QgbW1FbG0gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTsKICAgICAgICBtbUVsbS5pbm5lckhUTUwgPSBgPGRpdiBpZD0ibWVybWFpZC1pZC0ke21lcm1haWRJZH0iPiR7bWVybWFpZC5yZW5kZXIoYG1lcm1haWQtaWQtJHttZXJtYWlkSWR9YCwgbWVybWFpZERlZil9PC9kaXY+YDsKICAgICAgICBlbG0ucGFyZW50RWxlbWVudC5yZXBsYWNlV2l0aChtbUVsbSk7CiAgICAgIH0pOwogICAgfSwKCiAgICBhdXRvY29tcGxldGUoY20sIGNoYW5nZSkgewogICAgICBpZiAoY20uZ2V0TW9kZUF0KGNtLmdldEN1cnNvcigpKS5uYW1lICE9PSAnbWFya2Rvd24nKSB7CiAgICAgICAgcmV0dXJuOwogICAgICB9IC8vIExpbmtzCgoKICAgICAgaWYgKGNoYW5nZS50ZXh0WzBdID09PSAnKCcpIHsKICAgICAgICBjb25zdCBjdXJMaW5lID0gY20uZ2V0TGluZShjaGFuZ2UuZnJvbS5saW5lKS5zdWJzdHJpbmcoMCwgY2hhbmdlLmZyb20uY2gpOwoKICAgICAgICBpZiAoY3VyTGluZVtjdXJMaW5lLmxlbmd0aCAtIDFdID09PSAnXScpIHsKICAgICAgICAgIGNtLnNob3dIaW50KHsKICAgICAgICAgICAgaGludDogYXN5bmMgKGNtLCBvcHRpb25zKSA9PiB7CiAgICAgICAgICAgICAgY29uc3QgY3VyID0gY20uZ2V0Q3Vyc29yKCk7CiAgICAgICAgICAgICAgY29uc3QgY3VyTGluZSA9IGNtLmdldExpbmUoY3VyLmxpbmUpLnN1YnN0cmluZygwLCBjdXIuY2gpOwogICAgICAgICAgICAgIGNvbnN0IHF1ZXJ5U3RyaW5nID0gY3VyTGluZS5zdWJzdHJpbmcoY3VyTGluZS5sYXN0SW5kZXhPZignWycpICsgMSwgY3VyTGluZS5sZW5ndGggLSAyKTsKICAgICAgICAgICAgICBjb25zdCB0b2tlbiA9IGNtLmdldFRva2VuQXQoY3VyKTsKCiAgICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgIGNvbnN0IHJlc3BSYXcgPSBhd2FpdCB0aGlzLiRhcG9sbG8ucXVlcnkoewogICAgICAgICAgICAgICAgICBxdWVyeTogewogICAgICAgICAgICAgICAgICAgICJraW5kIjogIkRvY3VtZW50IiwKICAgICAgICAgICAgICAgICAgICAiZGVmaW5pdGlvbnMiOiBbewogICAgICAgICAgICAgICAgICAgICAgImtpbmQiOiAiT3BlcmF0aW9uRGVmaW5pdGlvbiIsCiAgICAgICAgICAgICAgICAgICAgICAib3BlcmF0aW9uIjogInF1ZXJ5IiwKICAgICAgICAgICAgICAgICAgICAgICJ2YXJpYWJsZURlZmluaXRpb25zIjogW3sKICAgICAgICAgICAgICAgICAgICAgICAgImtpbmQiOiAiVmFyaWFibGVEZWZpbml0aW9uIiwKICAgICAgICAgICAgICAgICAgICAgICAgInZhcmlhYmxlIjogewogICAgICAgICAgICAgICAgICAgICAgICAgICJraW5kIjogIlZhcmlhYmxlIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAibmFtZSI6IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICJraW5kIjogIk5hbWUiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgInZhbHVlIjogInF1ZXJ5IgogICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICAgICAgInR5cGUiOiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgImtpbmQiOiAiTm9uTnVsbFR5cGUiLAogICAgICAgICAgICAgICAgICAgICAgICAgICJ0eXBlIjogewogICAgICAgICAgICAgICAgICAgICAgICAgICAgImtpbmQiOiAiTmFtZWRUeXBlIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICJuYW1lIjogewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAia2luZCI6ICJOYW1lIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgInZhbHVlIjogIlN0cmluZyIKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgICAgICJkaXJlY3RpdmVzIjogW10KICAgICAgICAgICAgICAgICAgICAgIH0sIHsKICAgICAgICAgICAgICAgICAgICAgICAgImtpbmQiOiAiVmFyaWFibGVEZWZpbml0aW9uIiwKICAgICAgICAgICAgICAgICAgICAgICAgInZhcmlhYmxlIjogewogICAgICAgICAgICAgICAgICAgICAgICAgICJraW5kIjogIlZhcmlhYmxlIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAibmFtZSI6IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICJraW5kIjogIk5hbWUiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgInZhbHVlIjogImxvY2FsZSIKICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgICAgICJ0eXBlIjogewogICAgICAgICAgICAgICAgICAgICAgICAgICJraW5kIjogIk5hbWVkVHlwZSIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgIm5hbWUiOiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAia2luZCI6ICJOYW1lIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICJ2YWx1ZSI6ICJTdHJpbmciCiAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgICAgICAiZGlyZWN0aXZlcyI6IFtdCiAgICAgICAgICAgICAgICAgICAgICB9XSwKICAgICAgICAgICAgICAgICAgICAgICJkaXJlY3RpdmVzIjogW10sCiAgICAgICAgICAgICAgICAgICAgICAic2VsZWN0aW9uU2V0IjogewogICAgICAgICAgICAgICAgICAgICAgICAia2luZCI6ICJTZWxlY3Rpb25TZXQiLAogICAgICAgICAgICAgICAgICAgICAgICAic2VsZWN0aW9ucyI6IFt7CiAgICAgICAgICAgICAgICAgICAgICAgICAgImtpbmQiOiAiRmllbGQiLAogICAgICAgICAgICAgICAgICAgICAgICAgICJuYW1lIjogewogICAgICAgICAgICAgICAgICAgICAgICAgICAgImtpbmQiOiAiTmFtZSIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAidmFsdWUiOiAicGFnZXMiCiAgICAgICAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICAgICAgICAiYXJndW1lbnRzIjogW10sCiAgICAgICAgICAgICAgICAgICAgICAgICAgImRpcmVjdGl2ZXMiOiBbXSwKICAgICAgICAgICAgICAgICAgICAgICAgICAic2VsZWN0aW9uU2V0IjogewogICAgICAgICAgICAgICAgICAgICAgICAgICAgImtpbmQiOiAiU2VsZWN0aW9uU2V0IiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICJzZWxlY3Rpb25zIjogW3sKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgImtpbmQiOiAiRmllbGQiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAibmFtZSI6IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAia2luZCI6ICJOYW1lIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAidmFsdWUiOiAic2VhcmNoIgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAiYXJndW1lbnRzIjogW3sKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAia2luZCI6ICJBcmd1bWVudCIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIm5hbWUiOiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAia2luZCI6ICJOYW1lIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICJ2YWx1ZSI6ICJxdWVyeSIKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICJ2YWx1ZSI6IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICJraW5kIjogIlZhcmlhYmxlIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICJuYW1lIjogewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAia2luZCI6ICJOYW1lIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgInZhbHVlIjogInF1ZXJ5IgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSwgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICJraW5kIjogIkFyZ3VtZW50IiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAibmFtZSI6IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICJraW5kIjogIk5hbWUiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgInZhbHVlIjogImxvY2FsZSIKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICJ2YWx1ZSI6IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICJraW5kIjogIlZhcmlhYmxlIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICJuYW1lIjogewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAia2luZCI6ICJOYW1lIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgInZhbHVlIjogImxvY2FsZSIKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1dLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAiZGlyZWN0aXZlcyI6IFtdLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAic2VsZWN0aW9uU2V0IjogewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICJraW5kIjogIlNlbGVjdGlvblNldCIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgInNlbGVjdGlvbnMiOiBbewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgImtpbmQiOiAiRmllbGQiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIm5hbWUiOiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICJraW5kIjogIk5hbWUiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAidmFsdWUiOiAicmVzdWx0cyIKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAiYXJndW1lbnRzIjogW10sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAiZGlyZWN0aXZlcyI6IFtdLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgInNlbGVjdGlvblNldCI6IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgImtpbmQiOiAiU2VsZWN0aW9uU2V0IiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgInNlbGVjdGlvbnMiOiBbewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICJraW5kIjogIkZpZWxkIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAibmFtZSI6IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICJraW5kIjogIk5hbWUiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgInZhbHVlIjogInRpdGxlIgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgImFyZ3VtZW50cyI6IFtdLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICJkaXJlY3RpdmVzIjogW10KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSwgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICJraW5kIjogIkZpZWxkIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAibmFtZSI6IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICJraW5kIjogIk5hbWUiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgInZhbHVlIjogInBhdGgiCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAiYXJndW1lbnRzIjogW10sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgImRpcmVjdGl2ZXMiOiBbXQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LCB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgImtpbmQiOiAiRmllbGQiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICJuYW1lIjogewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgImtpbmQiOiAiTmFtZSIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAidmFsdWUiOiAibG9jYWxlIgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgImFyZ3VtZW50cyI6IFtdLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICJkaXJlY3RpdmVzIjogW10KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfV0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LCB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAia2luZCI6ICJGaWVsZCIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAibmFtZSI6IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgImtpbmQiOiAiTmFtZSIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICJ2YWx1ZSI6ICJ0b3RhbEhpdHMiCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgImFyZ3VtZW50cyI6IFtdLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgImRpcmVjdGl2ZXMiOiBbXQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1dCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1dCiAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB9XQogICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH1dLAogICAgICAgICAgICAgICAgICAgICJsb2MiOiB7CiAgICAgICAgICAgICAgICAgICAgICAic3RhcnQiOiAwLAogICAgICAgICAgICAgICAgICAgICAgImVuZCI6IDQ0OSwKICAgICAgICAgICAgICAgICAgICAgICJzb3VyY2UiOiB7CiAgICAgICAgICAgICAgICAgICAgICAgICJib2R5IjogIlxuICAgICAgICAgICAgICAgICAgICBxdWVyeSAoJHF1ZXJ5OiBTdHJpbmchLCAkbG9jYWxlOiBTdHJpbmcpIHtcbiAgICAgICAgICAgICAgICAgICAgICBwYWdlcyB7XG4gICAgICAgICAgICAgICAgICAgICAgICBzZWFyY2gocXVlcnk6JHF1ZXJ5LCBsb2NhbGU6JGxvY2FsZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICByZXN1bHRzIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aXRsZVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBhdGhcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsb2NhbGVcbiAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICB0b3RhbEhpdHNcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICIsCiAgICAgICAgICAgICAgICAgICAgICAgICJuYW1lIjogIkdyYXBoUUwgcmVxdWVzdCIsCiAgICAgICAgICAgICAgICAgICAgICAgICJsb2NhdGlvbk9mZnNldCI6IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAibGluZSI6IDEsCiAgICAgICAgICAgICAgICAgICAgICAgICAgImNvbHVtbiI6IDEKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgdmFyaWFibGVzOiB7CiAgICAgICAgICAgICAgICAgICAgcXVlcnk6IHF1ZXJ5U3RyaW5nLAogICAgICAgICAgICAgICAgICAgIGxvY2FsZTogdGhpcy5sb2NhbGUKICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgZmV0Y2hQb2xpY3k6ICdjYWNoZS1maXJzdCcKICAgICAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgICAgIGNvbnN0IHJlc3AgPSBfZ2V0KHJlc3BSYXcsICdkYXRhLnBhZ2VzLnNlYXJjaCcsIHt9KTsKCiAgICAgICAgICAgICAgICBpZiAocmVzcCAmJiByZXNwLnRvdGFsSGl0cyA+IDApIHsKICAgICAgICAgICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgICAgICAgICBsaXN0OiByZXNwLnJlc3VsdHMubWFwKHIgPT4gKHsKICAgICAgICAgICAgICAgICAgICAgIHRleHQ6ICcoJyArIChzaXRlTGFuZ3MubGVuZ3RoID4gMCA/IGAvJHtyLmxvY2FsZX0vJHtyLnBhdGh9YCA6IGAvJHtyLnBhdGh9YCkgKyAnKScsCiAgICAgICAgICAgICAgICAgICAgICBkaXNwbGF5VGV4dDogc2l0ZUxhbmdzLmxlbmd0aCA+IDAgPyBgLyR7ci5sb2NhbGV9LyR7ci5wYXRofSAtICR7ci50aXRsZX1gIDogYC8ke3IucGF0aH0gLSAke3IudGl0bGV9YAogICAgICAgICAgICAgICAgICAgIH0pKSwKICAgICAgICAgICAgICAgICAgICBmcm9tOiBDb2RlTWlycm9yLlBvcyhjdXIubGluZSwgdG9rZW4uc3RhcnQpLAogICAgICAgICAgICAgICAgICAgIHRvOiBDb2RlTWlycm9yLlBvcyhjdXIubGluZSwgdG9rZW4uZW5kKQogICAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0gY2F0Y2ggKGVycikge30KCiAgICAgICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgICAgIGxpc3Q6IFtdLAogICAgICAgICAgICAgICAgZnJvbTogQ29kZU1pcnJvci5Qb3MoY3VyLmxpbmUsIHRva2VuLnN0YXJ0KSwKICAgICAgICAgICAgICAgIHRvOiBDb2RlTWlycm9yLlBvcyhjdXIubGluZSwgdG9rZW4uZW5kKQogICAgICAgICAgICAgIH07CiAgICAgICAgICAgIH0KICAgICAgICAgIH0pOwogICAgICAgIH0KICAgICAgfQogICAgfSwKCiAgICBpbnNlcnRMaW5rKCkgewogICAgICB0aGlzLmluc2VydExpbmtEaWFsb2cgPSB0cnVlOwogICAgfSwKCiAgICBpbnNlcnRMaW5rSGFuZGxlcih7CiAgICAgIGxvY2FsZSwKICAgICAgcGF0aAogICAgfSkgewogICAgICBjb25zdCBsYXN0UGFydCA9IF9sYXN0KHBhdGguc3BsaXQoJy8nKSk7CgogICAgICB0aGlzLmluc2VydEF0Q3Vyc29yKHsKICAgICAgICBjb250ZW50OiBzaXRlTGFuZ3MubGVuZ3RoID4gMCA/IGBbJHtsYXN0UGFydH1dKC8ke2xvY2FsZX0vJHtwYXRofSlgIDogYFske2xhc3RQYXJ0fV0oLyR7cGF0aH0pYAogICAgICB9KTsKICAgIH0sCgogICAgcHJvY2Vzc01hcmtlcnMoZnJvbSwgdG8pIHsKICAgICAgbGV0IGZvdW5kID0gbnVsbDsKICAgICAgbGV0IGZvdW5kU3RhcnQgPSAwOwogICAgICB0aGlzLmNtLmRvYy5nZXRBbGxNYXJrcygpLmZvckVhY2gobWsgPT4gewogICAgICAgIGlmIChtay5fX2tpbmQpIHsKICAgICAgICAgIG1rLmNsZWFyKCk7CiAgICAgICAgfQogICAgICB9KTsKICAgICAgdGhpcy5jbS5lYWNoTGluZShmcm9tLCB0bywgbG4gPT4gewogICAgICAgIGNvbnN0IGxpbmUgPSBsbi5saW5lTm8oKTsKCiAgICAgICAgaWYgKGxuLnRleHQuc3RhcnRzV2l0aCgnYGBgZGlhZ3JhbScpKSB7CiAgICAgICAgICBmb3VuZCA9ICdkaWFncmFtJzsKICAgICAgICAgIGZvdW5kU3RhcnQgPSBsaW5lOwogICAgICAgIH0gZWxzZSBpZiAobG4udGV4dCA9PT0gJ2BgYCcgJiYgZm91bmQpIHsKICAgICAgICAgIHN3aXRjaCAoZm91bmQpIHsKICAgICAgICAgICAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICAgICAgICAgIC8vIC0+IERJQUdSQU0KICAgICAgICAgICAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICAgICAgICAgIGNhc2UgJ2RpYWdyYW0nOgogICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgIGlmIChsaW5lIC0gZm91bmRTdGFydCAhPT0gMikgewogICAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgdGhpcy5hZGRNYXJrZXIoewogICAgICAgICAgICAgICAgICBraW5kOiAnZGlhZ3JhbScsCiAgICAgICAgICAgICAgICAgIGZyb206IHsKICAgICAgICAgICAgICAgICAgICBsaW5lOiBmb3VuZFN0YXJ0LAogICAgICAgICAgICAgICAgICAgIGNoOiAzCiAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgIHRvOiB7CiAgICAgICAgICAgICAgICAgICAgbGluZTogZm91bmRTdGFydCwKICAgICAgICAgICAgICAgICAgICBjaDogMTAKICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgdGV4dDogJ0VkaXQgRGlhZ3JhbScsCiAgICAgICAgICAgICAgICAgIGFjdGlvbjogKChzdGFydCwgZW5kKSA9PiB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGV2ID0+IHsKICAgICAgICAgICAgICAgICAgICAgIHRoaXMuY20uZG9jLnNldFNlbGVjdGlvbih7CiAgICAgICAgICAgICAgICAgICAgICAgIGxpbmU6IHN0YXJ0LAogICAgICAgICAgICAgICAgICAgICAgICBjaDogMAogICAgICAgICAgICAgICAgICAgICAgfSwgewogICAgICAgICAgICAgICAgICAgICAgICBsaW5lOiBlbmQsCiAgICAgICAgICAgICAgICAgICAgICAgIGNoOiAzCiAgICAgICAgICAgICAgICAgICAgICB9KTsKCiAgICAgICAgICAgICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgICAgICAgICBjb25zdCByYXcgPSB0aGlzLmNtLmRvYy5nZXRMaW5lKGVuZCAtIDEpOwogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLiRzdG9yZS5zZXQoJ2VkaXRvci9hY3RpdmVNb2RhbERhdGEnLCBCdWZmZXIuZnJvbShyYXcsICdiYXNlNjQnKS50b1N0cmluZygpKTsKICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy50b2dnbGVNb2RhbChgZWRpdG9yTW9kYWxEcmF3aW9gKTsKICAgICAgICAgICAgICAgICAgICAgIH0gY2F0Y2ggKGVycikgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy4kc3RvcmUuY29tbWl0KCdzaG93Tm90aWZpY2F0aW9uJywgewogICAgICAgICAgICAgICAgICAgICAgICAgIG1lc3NhZ2U6ICdGYWlsZWQgdG8gcHJvY2VzcyBkaWFncmFtIGRhdGEuJywKICAgICAgICAgICAgICAgICAgICAgICAgICBzdHlsZTogJ3dhcm5pbmcnLAogICAgICAgICAgICAgICAgICAgICAgICAgIGljb246ICd3YXJuaW5nJwogICAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgICAgICB9KShmb3VuZFN0YXJ0LCBsaW5lKQogICAgICAgICAgICAgICAgfSk7CgogICAgICAgICAgICAgICAgaWYgKGxuLmhlaWdodCA+IDApIHsKICAgICAgICAgICAgICAgICAgdGhpcy5jbS5mb2xkQ29kZShmb3VuZFN0YXJ0KTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICB9CiAgICAgICAgICB9CgogICAgICAgICAgZm91bmQgPSBudWxsOwogICAgICAgIH0KICAgICAgfSk7CiAgICB9LAoKICAgIGFkZE1hcmtlcih7CiAgICAgIGtpbmQsCiAgICAgIGZyb20sCiAgICAgIHRvLAogICAgICB0ZXh0LAogICAgICBhY3Rpb24KICAgIH0pIHsKICAgICAgY29uc3QgbWFya2VyRWxtID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnc3BhbicpOwogICAgICBtYXJrZXJFbG0uYXBwZW5kQ2hpbGQoZG9jdW1lbnQuY3JlYXRlVGV4dE5vZGUodGV4dCkpOwogICAgICBtYXJrZXJFbG0uY2xhc3NOYW1lID0gJ0NvZGVNaXJyb3ItYnV0dG9ubWFya2VyJzsKICAgICAgbWFya2VyRWxtLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgYWN0aW9uKTsKICAgICAgdGhpcy5jbS5tYXJrVGV4dChmcm9tLCB0bywgewogICAgICAgIHJlcGxhY2VkV2l0aDogbWFya2VyRWxtLAogICAgICAgIF9fa2luZDoga2luZAogICAgICB9KTsKICAgIH0KCiAgfSwKCiAgbW91bnRlZCgpIHsKICAgIHRoaXMuJHN0b3JlLnNldCgnZWRpdG9yL2VkaXRvcktleScsICdtYXJrZG93bicpOwoKICAgIGlmICh0aGlzLm1vZGUgPT09ICdjcmVhdGUnICYmICF0aGlzLiRzdG9yZS5nZXQoJ2VkaXRvci9jb250ZW50JykpIHsKICAgICAgdGhpcy4kc3RvcmUuc2V0KCdlZGl0b3IvY29udGVudCcsICcjIEhlYWRlclxuWW91ciBjb250ZW50IGhlcmUnKTsKICAgIH0gLy8gSW5pdGlhbGl6ZSBNZXJtYWlkIEFQSQoKCiAgICBtZXJtYWlkLmluaXRpYWxpemUoewogICAgICBzdGFydE9uTG9hZDogZmFsc2UsCiAgICAgIHRoZW1lOiB0aGlzLiR2dWV0aWZ5LnRoZW1lLmRhcmsgPyBgZGFya2AgOiBgZGVmYXVsdGAKICAgIH0pOyAvLyBJbml0aWFsaXplIENvZGVNaXJyb3IKCiAgICB0aGlzLmNtID0gQ29kZU1pcnJvci5mcm9tVGV4dEFyZWEodGhpcy4kcmVmcy5jbSwgewogICAgICB0YWJTaXplOiAyLAogICAgICBtb2RlOiAndGV4dC9tYXJrZG93bicsCiAgICAgIHRoZW1lOiAnd2lraWpzLWRhcmsnLAogICAgICBsaW5lTnVtYmVyczogdHJ1ZSwKICAgICAgbGluZVdyYXBwaW5nOiB0cnVlLAogICAgICBsaW5lOiB0cnVlLAogICAgICBzdHlsZUFjdGl2ZUxpbmU6IHRydWUsCiAgICAgIGhpZ2hsaWdodFNlbGVjdGlvbk1hdGNoZXM6IHsKICAgICAgICBhbm5vdGF0ZVNjcm9sbGJhcjogdHJ1ZQogICAgICB9LAogICAgICB2aWV3cG9ydE1hcmdpbjogNTAsCiAgICAgIGlucHV0U3R5bGU6ICdjb250ZW50ZWRpdGFibGUnLAogICAgICBhbGxvd0Ryb3BGaWxlVHlwZXM6IFsnaW1hZ2UvanBnJywgJ2ltYWdlL3BuZycsICdpbWFnZS9zdmcnLCAnaW1hZ2UvanBlZycsICdpbWFnZS9naWYnXSwKICAgICAgZGlyZWN0aW9uOiBzaXRlQ29uZmlnLnJ0bCA/ICdydGwnIDogJ2x0cicsCiAgICAgIGZvbGRHdXR0ZXI6IHRydWUsCiAgICAgIGd1dHRlcnM6IFsnQ29kZU1pcnJvci1saW5lbnVtYmVycycsICdDb2RlTWlycm9yLWZvbGRndXR0ZXInXQogICAgfSk7CiAgICB0aGlzLmNtLnNldFZhbHVlKHRoaXMuJHN0b3JlLmdldCgnZWRpdG9yL2NvbnRlbnQnKSk7CiAgICB0aGlzLmNtLm9uKCdjaGFuZ2UnLCBjID0+IHsKICAgICAgdGhpcy4kc3RvcmUuc2V0KCdlZGl0b3IvY29udGVudCcsIGMuZ2V0VmFsdWUoKSk7CiAgICAgIHRoaXMub25DbUlucHV0KHRoaXMuJHN0b3JlLmdldCgnZWRpdG9yL2NvbnRlbnQnKSk7CiAgICB9KTsKCiAgICBpZiAodGhpcy4kdnVldGlmeS5icmVha3BvaW50Lm1kQW5kVXApIHsKICAgICAgdGhpcy5jbS5zZXRTaXplKG51bGwsICdjYWxjKDEwMHZoIC0gMTEycHggLSAyNHB4KScpOwogICAgfSBlbHNlIHsKICAgICAgdGhpcy5jbS5zZXRTaXplKG51bGwsICdjYWxjKDEwMHZoIC0gMTEycHggLSAxNnB4KScpOwogICAgfSAvLyBTZXQgS2V5YmluZGluZ3MKCgogICAgY29uc3Qga2V5QmluZGluZ3MgPSB7CiAgICAgICdGMTEnKGMpIHsKICAgICAgICBjLnNldE9wdGlvbignZnVsbFNjcmVlbicsICFjLmdldE9wdGlvbignZnVsbFNjcmVlbicpKTsKICAgICAgfSwKCiAgICAgICdFc2MnKGMpIHsKICAgICAgICBpZiAoYy5nZXRPcHRpb24oJ2Z1bGxTY3JlZW4nKSkgYy5zZXRPcHRpb24oJ2Z1bGxTY3JlZW4nLCBmYWxzZSk7CiAgICAgIH0KCiAgICB9OwoKICAgIF9zZXQoa2V5QmluZGluZ3MsIGAke0N0cmxLZXl9LVNgLCBjID0+IHsKICAgICAgdGhpcy5zYXZlKCk7CiAgICAgIHJldHVybiBmYWxzZTsKICAgIH0pOwoKICAgIF9zZXQoa2V5QmluZGluZ3MsIGAke0N0cmxLZXl9LUJgLCBjID0+IHsKICAgICAgdGhpcy50b2dnbGVNYXJrdXAoewogICAgICAgIHN0YXJ0OiBgKipgCiAgICAgIH0pOwogICAgICByZXR1cm4gZmFsc2U7CiAgICB9KTsKCiAgICBfc2V0KGtleUJpbmRpbmdzLCBgJHtDdHJsS2V5fS1JYCwgYyA9PiB7CiAgICAgIHRoaXMudG9nZ2xlTWFya3VwKHsKICAgICAgICBzdGFydDogYCpgCiAgICAgIH0pOwogICAgICByZXR1cm4gZmFsc2U7CiAgICB9KTsKCiAgICBfc2V0KGtleUJpbmRpbmdzLCBgJHtDdHJsS2V5fS1BbHQtUmlnaHRgLCBjID0+IHsKICAgICAgbGV0IGx2bCA9IHRoaXMuZ2V0SGVhZGVyTGV2ZWwoYyk7CgogICAgICBpZiAobHZsID49IDYpIHsKICAgICAgICBsdmwgPSA1OwogICAgICB9CgogICAgICB0aGlzLnNldEhlYWRlckxpbmUobHZsICsgMSk7CiAgICAgIHJldHVybiBmYWxzZTsKICAgIH0pOwoKICAgIF9zZXQoa2V5QmluZGluZ3MsIGAke0N0cmxLZXl9LUFsdC1MZWZ0YCwgYyA9PiB7CiAgICAgIGxldCBsdmwgPSB0aGlzLmdldEhlYWRlckxldmVsKGMpOwoKICAgICAgaWYgKGx2bCA8PSAxKSB7CiAgICAgICAgbHZsID0gMjsKICAgICAgfQoKICAgICAgdGhpcy5zZXRIZWFkZXJMaW5lKGx2bCAtIDEpOwogICAgICByZXR1cm4gZmFsc2U7CiAgICB9KTsKCiAgICB0aGlzLmNtLnNldE9wdGlvbignZXh0cmFLZXlzJywga2V5QmluZGluZ3MpOwogICAgdGhpcy5jbS5vbignaW5wdXRSZWFkJywgdGhpcy5hdXRvY29tcGxldGUpOyAvLyBIYW5kbGUgY3Vyc29yIG1vdmVtZW50CgogICAgdGhpcy5jbS5vbignY3Vyc29yQWN0aXZpdHknLCBjID0+IHsKICAgICAgdGhpcy5wb3NpdGlvblN5bmMoYyk7CiAgICAgIHRoaXMuc2Nyb2xsU3luYyhjKTsKICAgIH0pOyAvLyBIYW5kbGUgc3BlY2lhbCBwYXN0ZQoKICAgIHRoaXMuY20ub24oJ3Bhc3RlJywgdGhpcy5vbkNtUGFzdGUpOyAvLyBSZW5kZXIgaW5pdGlhbCBwcmV2aWV3CgogICAgdGhpcy5wcm9jZXNzQ29udGVudCh0aGlzLiRzdG9yZS5nZXQoJ2VkaXRvci9jb250ZW50JykpOwogICAgdGhpcy5yZWZyZXNoKCk7CiAgICB0aGlzLiRyb290LiRvbignZWRpdG9ySW5zZXJ0Jywgb3B0cyA9PiB7CiAgICAgIHN3aXRjaCAob3B0cy5raW5kKSB7CiAgICAgICAgY2FzZSAnSU1BR0UnOgogICAgICAgICAgbGV0IGltZyA9IGAhWyR7b3B0cy50ZXh0fV0oJHtvcHRzLnBhdGh9KWA7CgogICAgICAgICAgaWYgKG9wdHMuYWxpZ24gJiYgb3B0cy5hbGlnbiAhPT0gJycpIHsKICAgICAgICAgICAgaW1nICs9IGB7LmFsaWduLSR7b3B0cy5hbGlnbn19YDsKICAgICAgICAgIH0KCiAgICAgICAgICB0aGlzLmluc2VydEF0Q3Vyc29yKHsKICAgICAgICAgICAgY29udGVudDogaW1nCiAgICAgICAgICB9KTsKICAgICAgICAgIGJyZWFrOwoKICAgICAgICBjYXNlICdCSU5BUlknOgogICAgICAgICAgdGhpcy5pbnNlcnRBdEN1cnNvcih7CiAgICAgICAgICAgIGNvbnRlbnQ6IGBbJHtvcHRzLnRleHR9XSgke29wdHMucGF0aH0pYAogICAgICAgICAgfSk7CiAgICAgICAgICBicmVhazsKCiAgICAgICAgY2FzZSAnRElBR1JBTSc6CiAgICAgICAgICBjb25zdCBzZWxTdGFydExpbmUgPSB0aGlzLmNtLmdldEN1cnNvcignZnJvbScpLmxpbmU7CiAgICAgICAgICBjb25zdCBzZWxFbmRMaW5lID0gdGhpcy5jbS5nZXRDdXJzb3IoJ3RvJykubGluZSArIDE7CiAgICAgICAgICB0aGlzLmNtLmRvYy5yZXBsYWNlU2VsZWN0aW9uKCdgYGBkaWFncmFtXG4nICsgb3B0cy50ZXh0ICsgJ1xuYGBgXG4nLCAnc3RhcnQnKTsKICAgICAgICAgIHRoaXMucHJvY2Vzc01hcmtlcnMoc2VsU3RhcnRMaW5lLCBzZWxFbmRMaW5lKTsKICAgICAgICAgIGJyZWFrOwogICAgICB9CiAgICB9KTsgLy8gSGFuZGxlIHNhdmUgY29uZmxpY3QKCiAgICB0aGlzLiRyb290LiRvbignc2F2ZUNvbmZsaWN0JywgKCkgPT4gewogICAgICB0aGlzLnRvZ2dsZU1vZGFsKGBlZGl0b3JNb2RhbENvbmZsaWN0YCk7CiAgICB9KTsKICAgIHRoaXMuJHJvb3QuJG9uKCdvdmVyd3JpdGVFZGl0b3JDb250ZW50JywgKCkgPT4gewogICAgICB0aGlzLmNtLnNldFZhbHVlKHRoaXMuJHN0b3JlLmdldCgnZWRpdG9yL2NvbnRlbnQnKSk7CiAgICB9KTsKICB9LAoKICBiZWZvcmVEZXN0cm95KCkgewogICAgdGhpcy4kcm9vdC4kb2ZmKCdlZGl0b3JJbnNlcnQnKTsKICB9Cgp9Ow=="},null]}