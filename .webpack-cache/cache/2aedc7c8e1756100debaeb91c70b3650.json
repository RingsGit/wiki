{"remainingRequest":"/wiki/node_modules/babel-loader/lib/index.js??ref--0-1!/wiki/node_modules/vue-loader/lib/index.js??vue-loader-options!/wiki/client/components/editor/editor-markdown.vue?vue&type=script&lang=js&","dependencies":[{"path":"/wiki/client/components/editor/editor-markdown.vue","mtime":1742104565005},{"path":"/wiki/.babelrc","mtime":1742104564943},{"path":"/wiki/node_modules/cache-loader/dist/cjs.js","mtime":1742128641734},{"path":"/wiki/node_modules/babel-loader/lib/index.js","mtime":1742128638731},{"path":"/wiki/node_modules/vue-loader/lib/index.js","mtime":1742128750323}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0IF9zZXQgZnJvbSAibG9kYXNoL3NldCI7CmltcG9ydCBfZmluZExhc3QgZnJvbSAibG9kYXNoL2ZpbmRMYXN0IjsKaW1wb3J0IF9sYXN0IGZyb20gImxvZGFzaC9sYXN0IjsKaW1wb3J0IF9mbGF0dGVuIGZyb20gImxvZGFzaC9mbGF0dGVuIjsKaW1wb3J0IF9nZXQgZnJvbSAibG9kYXNoL2dldCI7CmltcG9ydCBfdGltZXMgZnJvbSAibG9kYXNoL3RpbWVzIjsKaW1wb3J0IF9zdGFydHNXaXRoIGZyb20gImxvZGFzaC9zdGFydHNXaXRoIjsKaW1wb3J0IF9kZWJvdW5jZSBmcm9tICJsb2Rhc2gvZGVib3VuY2UiOwppbXBvcnQgX2VzY2FwZSBmcm9tICJsb2Rhc2gvZXNjYXBlIjsKaW1wb3J0IHsgZ2V0LCBzeW5jIH0gZnJvbSAndnVleC1wYXRoaWZ5JzsKaW1wb3J0IG1hcmtkb3duSGVscCBmcm9tICcuL21hcmtkb3duL2hlbHAudnVlJzsKaW1wb3J0IERPTVB1cmlmeSBmcm9tICdkb21wdXJpZnknOwovKiBnbG9iYWwgc2l0ZUNvbmZpZywgc2l0ZUxhbmdzICovCi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KLy8gSU1QT1JUUwovLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09Ci8vIENvZGUgTWlycm9yCgppbXBvcnQgQ29kZU1pcnJvciBmcm9tICdjb2RlbWlycm9yJzsKaW1wb3J0ICdjb2RlbWlycm9yL2xpYi9jb2RlbWlycm9yLmNzcyc7IC8vIExhbmd1YWdlCgppbXBvcnQgJ2NvZGVtaXJyb3IvbW9kZS9tYXJrZG93bi9tYXJrZG93bi5qcyc7IC8vIEFkZG9ucwoKaW1wb3J0ICdjb2RlbWlycm9yL2FkZG9uL3NlbGVjdGlvbi9hY3RpdmUtbGluZS5qcyc7CmltcG9ydCAnY29kZW1pcnJvci9hZGRvbi9kaXNwbGF5L2Z1bGxzY3JlZW4uanMnOwppbXBvcnQgJ2NvZGVtaXJyb3IvYWRkb24vZGlzcGxheS9mdWxsc2NyZWVuLmNzcyc7CmltcG9ydCAnY29kZW1pcnJvci9hZGRvbi9zZWxlY3Rpb24vbWFyay1zZWxlY3Rpb24uanMnOwppbXBvcnQgJ2NvZGVtaXJyb3IvYWRkb24vc2VhcmNoL3NlYXJjaGN1cnNvci5qcyc7CmltcG9ydCAnY29kZW1pcnJvci9hZGRvbi9oaW50L3Nob3ctaGludC5qcyc7CmltcG9ydCAnY29kZW1pcnJvci9hZGRvbi9mb2xkL2ZvbGRjb2RlLmpzJzsKaW1wb3J0ICdjb2RlbWlycm9yL2FkZG9uL2ZvbGQvZm9sZGd1dHRlci5qcyc7CmltcG9ydCAnY29kZW1pcnJvci9hZGRvbi9mb2xkL2ZvbGRndXR0ZXIuY3NzJzsgLy8gTWFya2Rvd24taXQKCmltcG9ydCBNYXJrZG93bkl0IGZyb20gJ21hcmtkb3duLWl0JzsKaW1wb3J0IG1kQXR0cnMgZnJvbSAnbWFya2Rvd24taXQtYXR0cnMnOwppbXBvcnQgbWREZWNvcmF0ZSBmcm9tICdtYXJrZG93bi1pdC1kZWNvcmF0ZSc7CmltcG9ydCB7IGZ1bGwgYXMgbWRFbW9qaSB9IGZyb20gJ21hcmtkb3duLWl0LWVtb2ppJzsKaW1wb3J0IG1kVGFza0xpc3RzIGZyb20gJ21hcmtkb3duLWl0LXRhc2stbGlzdHMnOwppbXBvcnQgbWRFeHBhbmRUYWJzIGZyb20gJ21hcmtkb3duLWl0LWV4cGFuZC10YWJzJzsKaW1wb3J0IG1kQWJiciBmcm9tICdtYXJrZG93bi1pdC1hYmJyJzsKaW1wb3J0IG1kU3VwIGZyb20gJ21hcmtkb3duLWl0LXN1cCc7CmltcG9ydCBtZFN1YiBmcm9tICdtYXJrZG93bi1pdC1zdWInOwppbXBvcnQgbWRNYXJrIGZyb20gJ21hcmtkb3duLWl0LW1hcmsnOwppbXBvcnQgbWRNdWx0aVRhYmxlIGZyb20gJ21hcmtkb3duLWl0LW11bHRpbWQtdGFibGUnOwppbXBvcnQgbWRGb290bm90ZSBmcm9tICdtYXJrZG93bi1pdC1mb290bm90ZSc7CmltcG9ydCBtZEltc2l6ZSBmcm9tICdtYXJrZG93bi1pdC1pbXNpemUnOwppbXBvcnQga2F0ZXggZnJvbSAna2F0ZXgnOwppbXBvcnQgdW5kZXJsaW5lIGZyb20gJy4uLy4uL2xpYnMvbWFya2Rvd24taXQtdW5kZXJsaW5lJzsKaW1wb3J0ICdrYXRleC9kaXN0L2NvbnRyaWIvbWhjaGVtJzsKaW1wb3J0IHR3ZW1vamkgZnJvbSAndHdlbW9qaSc7CmltcG9ydCBwbGFudHVtbCBmcm9tICcuL21hcmtkb3duL3BsYW50dW1sJzsgLy8gUHJpc20gKFN5bnRheCBIaWdobGlnaHRpbmcpCgppbXBvcnQgUHJpc20gZnJvbSAicHJpc21qcy9jb21wb25lbnRzL3ByaXNtLWNvcmUiOyAvLyBNZXJtYWlkCgppbXBvcnQgInByaXNtanMvY29tcG9uZW50cy9wcmlzbS1jbGlrZSI7CmltcG9ydCAicHJpc21qcy9jb21wb25lbnRzL3ByaXNtLW1hcmt1cCI7CmltcG9ydCAicHJpc21qcy9wbHVnaW5zL2xpbmUtbnVtYmVycy9wcmlzbS1saW5lLW51bWJlcnMuY3NzIjsKaW1wb3J0ICJwcmlzbWpzL3BsdWdpbnMvbGluZS1udW1iZXJzL3ByaXNtLWxpbmUtbnVtYmVycyI7CmltcG9ydCAicHJpc21qcy9wbHVnaW5zL2F1dG9sb2FkZXIvcHJpc20tYXV0b2xvYWRlciI7CmltcG9ydCAicHJpc21qcy9wbHVnaW5zL25vcm1hbGl6ZS13aGl0ZXNwYWNlL3ByaXNtLW5vcm1hbGl6ZS13aGl0ZXNwYWNlIjsKaW1wb3J0ICJwcmlzbWpzL3BsdWdpbnMvdG9vbGJhci9wcmlzbS10b29sYmFyLmNzcyI7CmltcG9ydCAicHJpc21qcy9wbHVnaW5zL3Rvb2xiYXIvcHJpc20tdG9vbGJhciI7CmltcG9ydCAicHJpc21qcy9wbHVnaW5zL2NvcHktdG8tY2xpcGJvYXJkL3ByaXNtLWNvcHktdG8tY2xpcGJvYXJkIjsKaW1wb3J0ICJwcmlzbWpzL3RoZW1lcy9wcmlzbS10d2lsaWdodC5jc3MiOwppbXBvcnQgbWVybWFpZCBmcm9tICdtZXJtYWlkJzsgLy8gSGVscGVycwoKaW1wb3J0IGthdGV4SGVscGVyIGZyb20gJy4vY29tbW9uL2thdGV4JzsKaW1wb3J0IHRhYnNldEhlbHBlciBmcm9tICcuL21hcmtkb3duL3RhYnNldCc7CmltcG9ydCBjbUZvbGQgZnJvbSAnLi9jb21tb24vY21Gb2xkJzsgLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQovLyBJTklUCi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KLy8gUGxhdGZvcm0gZGV0ZWN0aW9uCgpjb25zdCBDdHJsS2V5ID0gL01hYy8udGVzdChuYXZpZ2F0b3IucGxhdGZvcm0pID8gJ0NtZCcgOiAnQ3RybCc7IC8vIFByaXNtIENvbmZpZwoKUHJpc20ucGx1Z2lucy5hdXRvbG9hZGVyLmxhbmd1YWdlc19wYXRoID0gJy9fYXNzZXRzL2pzL3ByaXNtLyc7ClByaXNtLnBsdWdpbnMuTm9ybWFsaXplV2hpdGVzcGFjZS5zZXREZWZhdWx0cyh7CiAgJ3JlbW92ZS10cmFpbGluZyc6IHRydWUsCiAgJ3JlbW92ZS1pbmRlbnQnOiB0cnVlLAogICdsZWZ0LXRyaW0nOiB0cnVlLAogICdyaWdodC10cmltJzogdHJ1ZSwKICAncmVtb3ZlLWluaXRpYWwtbGluZS1mZWVkJzogdHJ1ZSwKICAndGFicy10by1zcGFjZXMnOiAyCn0pOyAvLyBNYXJrZG93biBJbnN0YW5jZQoKY29uc3QgbWQgPSBuZXcgTWFya2Rvd25JdCh7CiAgaHRtbDogdHJ1ZSwKICBicmVha3M6IHRydWUsCiAgbGlua2lmeTogdHJ1ZSwKICB0eXBvZ3JhcGh5OiB0cnVlLAoKICBoaWdobGlnaHQoc3RyLCBsYW5nKSB7CiAgICBpZiAobGFuZyA9PT0gJ2RpYWdyYW0nKSB7CiAgICAgIHJldHVybiBgPHByZSBjbGFzcz0iZGlhZ3JhbSI+YCArIEJ1ZmZlci5mcm9tKHN0ciwgJ2Jhc2U2NCcpLnRvU3RyaW5nKCkgKyBgPC9wcmU+YDsKICAgIH0gZWxzZSBpZiAoWydtZXJtYWlkJywgJ3BsYW50dW1sJ10uaW5jbHVkZXMobGFuZykpIHsKICAgICAgcmV0dXJuIGA8cHJlIGNsYXNzPSJjb2RlYmxvY2stJHtsYW5nfSI+PGNvZGU+JHtfZXNjYXBlKHN0cil9PC9jb2RlPjwvcHJlPmA7CiAgICB9IGVsc2UgewogICAgICByZXR1cm4gYDxwcmUgY2xhc3M9ImxpbmUtbnVtYmVycyI+PGNvZGUgY2xhc3M9Imxhbmd1YWdlLSR7bGFuZ30iPiR7X2VzY2FwZShzdHIpfTwvY29kZT48L3ByZT5gOwogICAgfQogIH0KCn0pIC8vIFRPRE86IHNvbWUgaG93IHJlYWQgdGhlIGNvbmZpZyBmcm9tIGJhY2tlbmQ/Ci8vIC51c2UobWRBdHRycywgewovLyAgIGFsbG93ZWRBdHRyaWJ1dGVzOiBbJ2lkJywgJ2NsYXNzJywgJ3RhcmdldCddCi8vIH0pCi51c2UobWREZWNvcmF0ZSkudXNlKHVuZGVybGluZSkudXNlKG1kRW1vamkpLnVzZShtZFRhc2tMaXN0cywgewogIGxhYmVsOiBmYWxzZSwKICBsYWJlbEFmdGVyOiBmYWxzZQp9KS51c2UobWRFeHBhbmRUYWJzKS51c2UobWRBYmJyKS51c2UobWRTdXApLnVzZShtZFN1YikudXNlKG1kTXVsdGlUYWJsZSwgewogIG11bHRpbGluZTogdHJ1ZSwKICByb3dzcGFuOiB0cnVlLAogIGhlYWRlcmxlc3M6IHRydWUKfSkudXNlKG1kTWFyaykudXNlKG1kRm9vdG5vdGUpLnVzZShtZEltc2l6ZSk7IC8vIERPTVB1cmlmeSBmaXggZm9yIGRyYXcuaW8KCkRPTVB1cmlmeS5hZGRIb29rKCd1cG9uU2FuaXRpemVFbGVtZW50JywgZWxtID0+IHsKICBpZiAoZWxtLnF1ZXJ5U2VsZWN0b3JBbGwpIHsKICAgIGNvbnN0IGJyZWFrcyA9IGVsbS5xdWVyeVNlbGVjdG9yQWxsKCdmb3JlaWduT2JqZWN0IGJyLCBmb3JlaWduT2JqZWN0IHAnKTsKCiAgICBpZiAoYnJlYWtzICYmIGJyZWFrcy5sZW5ndGgpIHsKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBicmVha3MubGVuZ3RoOyBpKyspIHsKICAgICAgICBicmVha3NbaV0ucGFyZW50Tm9kZS5yZXBsYWNlQ2hpbGQoZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2JyksIGJyZWFrc1tpXSk7CiAgICAgIH0KICAgIH0KICB9Cn0pOyAvLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09Ci8vIEhFTFBFUiBGVU5DVElPTlMKLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQovLyBJbmplY3QgbGluZSBudW1iZXJzIGZvciBwcmV2aWV3IHNjcm9sbCBzeW5jCgpsZXQgbGluZXNNYXAgPSBbXTsKCmZ1bmN0aW9uIGluamVjdExpbmVOdW1iZXJzKHRva2VucywgaWR4LCBvcHRpb25zLCBlbnYsIHNsZikgewogIGxldCBsaW5lOwoKICBpZiAodG9rZW5zW2lkeF0ubWFwICYmIHRva2Vuc1tpZHhdLmxldmVsID09PSAwKSB7CiAgICBsaW5lID0gdG9rZW5zW2lkeF0ubWFwWzBdOwogICAgdG9rZW5zW2lkeF0uYXR0ckpvaW4oJ2NsYXNzJywgJ2xpbmUnKTsKICAgIHRva2Vuc1tpZHhdLmF0dHJTZXQoJ2RhdGEtbGluZScsIFN0cmluZyhsaW5lKSk7CiAgICBsaW5lc01hcC5wdXNoKGxpbmUpOwogIH0KCiAgcmV0dXJuIHNsZi5yZW5kZXJUb2tlbih0b2tlbnMsIGlkeCwgb3B0aW9ucywgZW52LCBzbGYpOwp9CgptZC5yZW5kZXJlci5ydWxlcy5wYXJhZ3JhcGhfb3BlbiA9IGluamVjdExpbmVOdW1iZXJzOwptZC5yZW5kZXJlci5ydWxlcy5oZWFkaW5nX29wZW4gPSBpbmplY3RMaW5lTnVtYmVyczsKbWQucmVuZGVyZXIucnVsZXMuYmxvY2txdW90ZV9vcGVuID0gaW5qZWN0TGluZU51bWJlcnM7CmNtRm9sZC5yZWdpc3RlcignbWFya2Rvd24nKTsgLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQovLyBQTEFOVFVNTAovLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09Ci8vIFRPRE86IFVzZSBzYW1lIG9wdGlvbnMgYXMgZGVmaW5lZCBpbiBiYWNrZW5kCgpwbGFudHVtbC5pbml0KG1kLCB7fSk7IC8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KLy8gS0FURVgKLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQoKY29uc3QgbWFjcm9zID0ge307Cm1kLmlubGluZS5ydWxlci5hZnRlcignZXNjYXBlJywgJ2thdGV4X2lubGluZScsIGthdGV4SGVscGVyLmthdGV4SW5saW5lKTsKCm1kLnJlbmRlcmVyLnJ1bGVzLmthdGV4X2lubGluZSA9ICh0b2tlbnMsIGlkeCkgPT4gewogIHRyeSB7CiAgICByZXR1cm4ga2F0ZXgucmVuZGVyVG9TdHJpbmcodG9rZW5zW2lkeF0uY29udGVudCwgewogICAgICBkaXNwbGF5TW9kZTogZmFsc2UsCiAgICAgIG1hY3JvcwogICAgfSk7CiAgfSBjYXRjaCAoZXJyKSB7CiAgICBjb25zb2xlLndhcm4oZXJyKTsKICAgIHJldHVybiB0b2tlbnNbaWR4XS5jb250ZW50OwogIH0KfTsKCm1kLmJsb2NrLnJ1bGVyLmFmdGVyKCdibG9ja3F1b3RlJywgJ2thdGV4X2Jsb2NrJywga2F0ZXhIZWxwZXIua2F0ZXhCbG9jaywgewogIGFsdDogWydwYXJhZ3JhcGgnLCAncmVmZXJlbmNlJywgJ2Jsb2NrcXVvdGUnLCAnbGlzdCddCn0pOwoKbWQucmVuZGVyZXIucnVsZXMua2F0ZXhfYmxvY2sgPSAodG9rZW5zLCBpZHgpID0+IHsKICB0cnkgewogICAgcmV0dXJuIGA8cD5gICsga2F0ZXgucmVuZGVyVG9TdHJpbmcodG9rZW5zW2lkeF0uY29udGVudCwgewogICAgICBkaXNwbGF5TW9kZTogdHJ1ZSwKICAgICAgbWFjcm9zCiAgICB9KSArIGA8L3A+YDsKICB9IGNhdGNoIChlcnIpIHsKICAgIGNvbnNvbGUud2FybihlcnIpOwogICAgcmV0dXJuIHRva2Vuc1tpZHhdLmNvbnRlbnQ7CiAgfQp9OyAvLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09Ci8vIFRXRU1PSkkKLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQoKCm1kLnJlbmRlcmVyLnJ1bGVzLmVtb2ppID0gKHRva2VuLCBpZHgpID0+IHsKICByZXR1cm4gdHdlbW9qaS5wYXJzZSh0b2tlbltpZHhdLmNvbnRlbnQsIHsKICAgIGNhbGxiYWNrKGljb24sIG9wdHMpIHsKICAgICAgcmV0dXJuIGAvX2Fzc2V0cy9zdmcvdHdlbW9qaS8ke2ljb259LnN2Z2A7CiAgICB9CgogIH0pOwp9OyAvLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09Ci8vIFZ1ZSBDb21wb25lbnQKLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQoKCmxldCBtZXJtYWlkSWQgPSAwOwpleHBvcnQgZGVmYXVsdCB7CiAgY29tcG9uZW50czogewogICAgbWFya2Rvd25IZWxwCiAgfSwKICBwcm9wczogewogICAgc2F2ZTogewogICAgICB0eXBlOiBGdW5jdGlvbiwKICAgICAgZGVmYXVsdDogKCkgPT4ge30KICAgIH0KICB9LAoKICBkYXRhKCkgewogICAgcmV0dXJuIHsKICAgICAgZmFiSW5zZXJ0TWVudTogZmFsc2UsCiAgICAgIGNtOiBudWxsLAogICAgICBjdXJzb3JQb3M6IHsKICAgICAgICBjaDogMCwKICAgICAgICBsaW5lOiAxCiAgICAgIH0sCiAgICAgIHByZXZpZXdTaG93bjogdHJ1ZSwKICAgICAgcHJldmlld0hUTUw6ICcnLAogICAgICBoZWxwU2hvd246IGZhbHNlLAogICAgICBzcGVsbE1vZGVBY3RpdmU6IGZhbHNlLAogICAgICBpbnNlcnRMaW5rRGlhbG9nOiBmYWxzZQogICAgfTsKICB9LAoKICBjb21wdXRlZDogewogICAgaXNNb2JpbGUoKSB7CiAgICAgIHJldHVybiB0aGlzLiR2dWV0aWZ5LmJyZWFrcG9pbnQuc21BbmREb3duOwogICAgfSwKCiAgICBpc01vZGFsU2hvd24oKSB7CiAgICAgIHJldHVybiB0aGlzLmhlbHBTaG93biB8fCB0aGlzLmFjdGl2ZU1vZGFsICE9PSAnJzsKICAgIH0sCgogICAgbG9jYWxlOiBnZXQoJ3BhZ2UvbG9jYWxlJyksCiAgICBwYXRoOiBnZXQoJ3BhZ2UvcGF0aCcpLAogICAgbW9kZTogZ2V0KCdlZGl0b3IvbW9kZScpLAogICAgYWN0aXZlTW9kYWw6IHN5bmMoJ2VkaXRvci9hY3RpdmVNb2RhbCcpCiAgfSwKICB3YXRjaDogewogICAgcHJldmlld1Nob3duKG5ld1ZhbHVlLCBvbGRWYWx1ZSkgewogICAgICBpZiAobmV3VmFsdWUgJiYgIW9sZFZhbHVlKSB7CiAgICAgICAgdGhpcy4kbmV4dFRpY2soKCkgPT4gewogICAgICAgICAgdGhpcy5yZW5kZXJNZXJtYWlkRGlhZ3JhbXMoKTsKICAgICAgICAgIFByaXNtLmhpZ2hsaWdodEFsbFVuZGVyKHRoaXMuJHJlZnMuZWRpdG9yUHJldmlldyk7CiAgICAgICAgICBBcnJheS5mcm9tKHRoaXMuJHJlZnMuZWRpdG9yUHJldmlldy5xdWVyeVNlbGVjdG9yQWxsKCdwcmUubGluZS1udW1iZXJzJykpLmZvckVhY2gocHJlID0+IHByZS5jbGFzc0xpc3QuYWRkKCdwcmlzbWpzJykpOwogICAgICAgIH0pOwogICAgICB9CiAgICB9LAoKICAgIHNwZWxsTW9kZUFjdGl2ZShuZXdWYWx1ZSwgb2xkVmFsdWUpIHsKICAgICAgaWYgKG5ld1ZhbHVlKSB7CiAgICAgICAgdGhpcy4kbmV4dFRpY2soKCkgPT4gewogICAgICAgICAgdGhpcy4kcmVmcy5lZGl0b3JQcmV2aWV3LmZvY3VzKCk7CiAgICAgICAgfSk7CiAgICAgIH0KICAgIH0KCiAgfSwKICBtZXRob2RzOiB7CiAgICB0b2dnbGVNb2RhbChrZXkpIHsKICAgICAgdGhpcy5hY3RpdmVNb2RhbCA9IHRoaXMuYWN0aXZlTW9kYWwgPT09IGtleSA/ICcnIDoga2V5OwogICAgICB0aGlzLmhlbHBTaG93biA9IGZhbHNlOwogICAgfSwKCiAgICBjbG9zZUFsbE1vZGFsKCkgewogICAgICB0aGlzLmFjdGl2ZU1vZGFsID0gJyc7CiAgICAgIHRoaXMuaGVscFNob3duID0gZmFsc2U7CiAgICB9LAoKICAgIG9uQ21JbnB1dDogX2RlYm91bmNlKGZ1bmN0aW9uIChuZXdDb250ZW50KSB7CiAgICAgIHRoaXMucHJvY2Vzc0NvbnRlbnQobmV3Q29udGVudCk7CiAgICB9LCA2MDApLAoKICAgIG9uQ21QYXN0ZShjbSwgZXYpIHsvLyBjb25zdCBjbGlwSXRlbXMgPSAoZXYuY2xpcGJvYXJkRGF0YSB8fCBldi5vcmlnaW5hbEV2ZW50LmNsaXBib2FyZERhdGEpLml0ZW1zCiAgICAgIC8vIGZvciAobGV0IGNsaXBJdGVtIG9mIGNsaXBJdGVtcykgewogICAgICAvLyAgIGlmIChfLnN0YXJ0c1dpdGgoY2xpcEl0ZW0udHlwZSwgJ2ltYWdlLycpKSB7CiAgICAgIC8vICAgICBjb25zdCBmaWxlID0gY2xpcEl0ZW0uZ2V0QXNGaWxlKCkKICAgICAgLy8gICAgIGNvbnN0IHJlYWRlciA9IG5ldyBGaWxlUmVhZGVyKCkKICAgICAgLy8gICAgIHJlYWRlci5vbmxvYWQgPSBldnQgPT4gewogICAgICAvLyAgICAgICB0aGlzLiRzdG9yZS5jb21taXQoYGxvYWRpbmdTdGFydGAsICdlZGl0b3ItcGFzdGUtaW1hZ2UnKQogICAgICAvLyAgICAgICB0aGlzLmluc2VydEFmdGVyKHsKICAgICAgLy8gICAgICAgICBjb250ZW50OiBgIVske2ZpbGUubmFtZX1dKCR7ZXZ0LnRhcmdldC5yZXN1bHR9KWAsCiAgICAgIC8vICAgICAgICAgbmV3TGluZTogdHJ1ZQogICAgICAvLyAgICAgICB9KQogICAgICAvLyAgICAgfQogICAgICAvLyAgICAgcmVhZGVyLnJlYWRBc0RhdGFVUkwoZmlsZSkKICAgICAgLy8gICB9CiAgICAgIC8vIH0KICAgIH0sCgogICAgcHJvY2Vzc0NvbnRlbnQobmV3Q29udGVudCkgewogICAgICBsaW5lc01hcCA9IFtdOyAvLyB0aGlzLiRzdG9yZS5zZXQoJ2VkaXRvci9jb250ZW50JywgbmV3Q29udGVudCkKCiAgICAgIHRoaXMucHJvY2Vzc01hcmtlcnModGhpcy5jbS5maXJzdExpbmUoKSwgdGhpcy5jbS5sYXN0TGluZSgpKTsKICAgICAgdGhpcy5wcmV2aWV3SFRNTCA9IERPTVB1cmlmeS5zYW5pdGl6ZShtZC5yZW5kZXIobmV3Q29udGVudCksIHsKICAgICAgICBBRERfVEFHUzogWydmb3JlaWduT2JqZWN0J10KICAgICAgfSk7CiAgICAgIHRoaXMuJG5leHRUaWNrKCgpID0+IHsKICAgICAgICB0YWJzZXRIZWxwZXIuZm9ybWF0KCk7CiAgICAgICAgdGhpcy5yZW5kZXJNZXJtYWlkRGlhZ3JhbXMoKTsKICAgICAgICBQcmlzbS5oaWdobGlnaHRBbGxVbmRlcih0aGlzLiRyZWZzLmVkaXRvclByZXZpZXcpOwogICAgICAgIEFycmF5LmZyb20odGhpcy4kcmVmcy5lZGl0b3JQcmV2aWV3LnF1ZXJ5U2VsZWN0b3JBbGwoJ3ByZS5saW5lLW51bWJlcnMnKSkuZm9yRWFjaChwcmUgPT4gcHJlLmNsYXNzTGlzdC5hZGQoJ3ByaXNtanMnKSk7CiAgICAgICAgdGhpcy5zY3JvbGxTeW5jKHRoaXMuY20pOwogICAgICB9KTsKICAgIH0sCgogICAgLyoqDQogICAgICogVXBkYXRlIGN1cnNvciBzdGF0ZQ0KICAgICAqLwogICAgcG9zaXRpb25TeW5jKGNtKSB7CiAgICAgIHRoaXMuY3Vyc29yUG9zID0gY20uZ2V0Q3Vyc29yKCdoZWFkJyk7CiAgICB9LAoKICAgIC8qKg0KICAgICAqIFdyYXAgc2VsZWN0aW9uIHdpdGggc3RhcnQgLyBlbmQgdGFncw0KICAgICAqLwogICAgdG9nZ2xlTWFya3VwKHsKICAgICAgc3RhcnQsCiAgICAgIGVuZAogICAgfSkgewogICAgICBpZiAoIWVuZCkgewogICAgICAgIGVuZCA9IHN0YXJ0OwogICAgICB9CgogICAgICBpZiAoIXRoaXMuY20uZG9jLnNvbWV0aGluZ1NlbGVjdGVkKCkpIHsKICAgICAgICByZXR1cm4gdGhpcy4kc3RvcmUuY29tbWl0KCdzaG93Tm90aWZpY2F0aW9uJywgewogICAgICAgICAgbWVzc2FnZTogdGhpcy4kdCgnZWRpdG9yOm1hcmt1cC5ub1NlbGVjdGlvbkVycm9yJyksCiAgICAgICAgICBzdHlsZTogJ3dhcm5pbmcnLAogICAgICAgICAgaWNvbjogJ3dhcm5pbmcnCiAgICAgICAgfSk7CiAgICAgIH0KCiAgICAgIHRoaXMuY20uZG9jLnJlcGxhY2VTZWxlY3Rpb25zKHRoaXMuY20uZG9jLmdldFNlbGVjdGlvbnMoKS5tYXAocyA9PiBzdGFydCArIHMgKyBlbmQpKTsKICAgIH0sCgogICAgLyoqDQogICAgICogU2V0IGN1cnJlbnQgbGluZSBhcyBoZWFkZXINCiAgICAgKi8KICAgIHNldEhlYWRlckxpbmUobHZsKSB7CiAgICAgIGNvbnN0IGN1ckxpbmUgPSB0aGlzLmNtLmRvYy5nZXRDdXJzb3IoJ2hlYWQnKS5saW5lOwogICAgICBsZXQgbGluZUNvbnRlbnQgPSB0aGlzLmNtLmRvYy5nZXRMaW5lKGN1ckxpbmUpOwogICAgICBjb25zdCBsaW5lTGVuZ3RoID0gbGluZUNvbnRlbnQubGVuZ3RoOwoKICAgICAgaWYgKF9zdGFydHNXaXRoKGxpbmVDb250ZW50LCAnIycpKSB7CiAgICAgICAgbGluZUNvbnRlbnQgPSBsaW5lQ29udGVudC5yZXBsYWNlKC9eKCMrICkvLCAnJyk7CiAgICAgIH0KCiAgICAgIGxpbmVDb250ZW50ID0gX3RpbWVzKGx2bCwgbiA9PiAnIycpLmpvaW4oJycpICsgYCBgICsgbGluZUNvbnRlbnQ7CiAgICAgIHRoaXMuY20uZG9jLnJlcGxhY2VSYW5nZShsaW5lQ29udGVudCwgewogICAgICAgIGxpbmU6IGN1ckxpbmUsCiAgICAgICAgY2g6IDAKICAgICAgfSwgewogICAgICAgIGxpbmU6IGN1ckxpbmUsCiAgICAgICAgY2g6IGxpbmVMZW5ndGgKICAgICAgfSk7CiAgICB9LAoKICAgIC8qKg0KICAgICAqIEdldCB0aGUgaGVhZGVyIGxldmVyIG9mIHRoZSBjdXJyZW50IGxpbmUNCiAgICAgKi8KICAgIGdldEhlYWRlckxldmVsKGNtKSB7CiAgICAgIGNvbnN0IGN1ckxpbmUgPSB0aGlzLmNtLmRvYy5nZXRDdXJzb3IoJ2hlYWQnKS5saW5lOwogICAgICBsZXQgbGluZUNvbnRlbnQgPSB0aGlzLmNtLmRvYy5nZXRMaW5lKGN1ckxpbmUpOwogICAgICBsZXQgbHZsID0gMDsKICAgICAgY29uc3QgcmVzdWx0ID0gbGluZUNvbnRlbnQubWF0Y2goL14oIyspIC8pOwoKICAgICAgaWYgKHJlc3VsdCkgewogICAgICAgIGx2bCA9IF9nZXQocmVzdWx0LCAnWzFdJywgJycpLmxlbmd0aDsKICAgICAgfQoKICAgICAgcmV0dXJuIGx2bDsKICAgIH0sCgogICAgLyoqDQogICAgICogSW5zZXJ0IGNvbnRlbnQgYXQgY3Vyc29yDQogICAgICovCiAgICBpbnNlcnRBdEN1cnNvcih7CiAgICAgIGNvbnRlbnQKICAgIH0pIHsKICAgICAgY29uc3QgY3Vyc29yID0gdGhpcy5jbS5kb2MuZ2V0Q3Vyc29yKCdoZWFkJyk7CiAgICAgIHRoaXMuY20uZG9jLnJlcGxhY2VSYW5nZShjb250ZW50LCBjdXJzb3IpOwogICAgfSwKCiAgICAvKioNCiAgICAgKiBJbnNlcnQgY29udGVudCBhZnRlciBjdXJyZW50IGxpbmUNCiAgICAgKi8KICAgIGluc2VydEFmdGVyKHsKICAgICAgY29udGVudCwKICAgICAgbmV3TGluZQogICAgfSkgewogICAgICBjb25zdCBjdXJMaW5lID0gdGhpcy5jbS5kb2MuZ2V0Q3Vyc29yKCd0bycpLmxpbmU7CiAgICAgIGNvbnN0IGxpbmVMZW5ndGggPSB0aGlzLmNtLmRvYy5nZXRMaW5lKGN1ckxpbmUpLmxlbmd0aDsKICAgICAgdGhpcy5jbS5kb2MucmVwbGFjZVJhbmdlKG5ld0xpbmUgPyBgXG4ke2NvbnRlbnR9XG5gIDogY29udGVudCwgewogICAgICAgIGxpbmU6IGN1ckxpbmUsCiAgICAgICAgY2g6IGxpbmVMZW5ndGggKyAxCiAgICAgIH0pOwogICAgfSwKCiAgICAvKioNCiAgICAgKiBJbnNlcnQgY29udGVudCBiZWZvcmUgY3VycmVudCBsaW5lDQogICAgICovCiAgICBpbnNlcnRCZWZvcmVFYWNoTGluZSh7CiAgICAgIGNvbnRlbnQsCiAgICAgIGFmdGVyCiAgICB9KSB7CiAgICAgIGxldCBsaW5lcyA9IFtdOwoKICAgICAgaWYgKCF0aGlzLmNtLmRvYy5zb21ldGhpbmdTZWxlY3RlZCgpKSB7CiAgICAgICAgbGluZXMucHVzaCh0aGlzLmNtLmRvYy5nZXRDdXJzb3IoJ2hlYWQnKS5saW5lKTsKICAgICAgfSBlbHNlIHsKICAgICAgICBsaW5lcyA9IF9mbGF0dGVuKHRoaXMuY20uZG9jLmxpc3RTZWxlY3Rpb25zKCkubWFwKHNsID0+IHsKICAgICAgICAgIGNvbnN0IHJhbmdlID0gTWF0aC5hYnMoc2wuYW5jaG9yLmxpbmUgLSBzbC5oZWFkLmxpbmUpICsgMTsKICAgICAgICAgIGNvbnN0IGxvd2VzdExpbmUgPSBzbC5hbmNob3IubGluZSA+IHNsLmhlYWQubGluZSA/IHNsLmhlYWQubGluZSA6IHNsLmFuY2hvci5saW5lOwogICAgICAgICAgcmV0dXJuIF90aW1lcyhyYW5nZSwgbCA9PiBsICsgbG93ZXN0TGluZSk7CiAgICAgICAgfSkpOwogICAgICB9CgogICAgICBsaW5lcy5mb3JFYWNoKGxuID0+IHsKICAgICAgICBsZXQgbGluZUNvbnRlbnQgPSB0aGlzLmNtLmRvYy5nZXRMaW5lKGxuKTsKICAgICAgICBjb25zdCBsaW5lTGVuZ3RoID0gbGluZUNvbnRlbnQubGVuZ3RoOwoKICAgICAgICBpZiAoX3N0YXJ0c1dpdGgobGluZUNvbnRlbnQsIGNvbnRlbnQpKSB7CiAgICAgICAgICBsaW5lQ29udGVudCA9IGxpbmVDb250ZW50LnN1YnN0cmluZyhjb250ZW50Lmxlbmd0aCk7CiAgICAgICAgfQoKICAgICAgICB0aGlzLmNtLmRvYy5yZXBsYWNlUmFuZ2UoY29udGVudCArIGxpbmVDb250ZW50LCB7CiAgICAgICAgICBsaW5lOiBsbiwKICAgICAgICAgIGNoOiAwCiAgICAgICAgfSwgewogICAgICAgICAgbGluZTogbG4sCiAgICAgICAgICBjaDogbGluZUxlbmd0aAogICAgICAgIH0pOwogICAgICB9KTsKCiAgICAgIGlmIChhZnRlcikgewogICAgICAgIGNvbnN0IGxhc3RMaW5lID0gX2xhc3QobGluZXMpOwoKICAgICAgICB0aGlzLmNtLmRvYy5yZXBsYWNlUmFuZ2UoYFxuJHthZnRlcn1cbmAsIHsKICAgICAgICAgIGxpbmU6IGxhc3RMaW5lLAogICAgICAgICAgY2g6IHRoaXMuY20uZG9jLmdldExpbmUobGFzdExpbmUpLmxlbmd0aCArIDEKICAgICAgICB9KTsKICAgICAgfQogICAgfSwKCiAgICAvKioNCiAgICAgKiBVcGRhdGUgc2Nyb2xsIHN5bmMNCiAgICAgKi8KICAgIHNjcm9sbFN5bmM6IF9kZWJvdW5jZShmdW5jdGlvbiAoY20pIHsKICAgICAgaWYgKCF0aGlzLnByZXZpZXdTaG93biB8fCBjbS5zb21ldGhpbmdTZWxlY3RlZCgpKSB7CiAgICAgICAgcmV0dXJuOwogICAgICB9CgogICAgICBsZXQgY3VycmVudExpbmUgPSBjbS5nZXRDdXJzb3IoKS5saW5lOwoKICAgICAgaWYgKGN1cnJlbnRMaW5lIDwgMykgewogICAgICAgIHRoaXMuVmVsb2NpdHkodGhpcy4kcmVmcy5lZGl0b3JQcmV2aWV3LCAnc3RvcCcsIHRydWUpOwogICAgICAgIHRoaXMuVmVsb2NpdHkodGhpcy4kcmVmcy5lZGl0b3JQcmV2aWV3LmZpcnN0Q2hpbGQsICdzY3JvbGwnLCB7CiAgICAgICAgICBvZmZzZXQ6ICctNTAnLAogICAgICAgICAgZHVyYXRpb246IDEwMDAsCiAgICAgICAgICBjb250YWluZXI6IHRoaXMuJHJlZnMuZWRpdG9yUHJldmlld0NvbnRhaW5lcgogICAgICAgIH0pOwogICAgICB9IGVsc2UgewogICAgICAgIGxldCBjbG9zZXN0TGluZSA9IF9maW5kTGFzdChsaW5lc01hcCwgbiA9PiBuIDw9IGN1cnJlbnRMaW5lKTsKCiAgICAgICAgbGV0IGRlc3RFbG0gPSB0aGlzLiRyZWZzLmVkaXRvclByZXZpZXcucXVlcnlTZWxlY3RvcihgW2RhdGEtbGluZT0nJHtjbG9zZXN0TGluZX0nXWApOwoKICAgICAgICBpZiAoZGVzdEVsbSkgewogICAgICAgICAgdGhpcy5WZWxvY2l0eSh0aGlzLiRyZWZzLmVkaXRvclByZXZpZXcsICdzdG9wJywgdHJ1ZSk7CiAgICAgICAgICB0aGlzLlZlbG9jaXR5KGRlc3RFbG0sICdzY3JvbGwnLCB7CiAgICAgICAgICAgIG9mZnNldDogJy0xMDAnLAogICAgICAgICAgICBkdXJhdGlvbjogMTAwMCwKICAgICAgICAgICAgY29udGFpbmVyOiB0aGlzLiRyZWZzLmVkaXRvclByZXZpZXdDb250YWluZXIKICAgICAgICAgIH0pOwogICAgICAgIH0KICAgICAgfQogICAgfSwgNTAwKSwKCiAgICB0b2dnbGVIZWxwKCkgewogICAgICB0aGlzLmhlbHBTaG93biA9ICF0aGlzLmhlbHBTaG93bjsKICAgICAgdGhpcy5hY3RpdmVNb2RhbCA9ICcnOwogICAgfSwKCiAgICB0b2dnbGVGdWxsc2NyZWVuKCkgewogICAgICB0aGlzLmNtLnNldE9wdGlvbignZnVsbFNjcmVlbicsIHRydWUpOwogICAgfSwKCiAgICByZWZyZXNoKCkgewogICAgICB0aGlzLiRuZXh0VGljaygoKSA9PiB7CiAgICAgICAgdGhpcy5jbS5yZWZyZXNoKCk7CiAgICAgIH0pOwogICAgfSwKCiAgICByZW5kZXJNZXJtYWlkRGlhZ3JhbXMoKSB7CiAgICAgIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJy5lZGl0b3ItbWFya2Rvd24tcHJldmlldyBwcmUuY29kZWJsb2NrLW1lcm1haWQgPiBjb2RlJykuZm9yRWFjaChlbG0gPT4gewogICAgICAgIG1lcm1haWRJZCsrOwogICAgICAgIGNvbnN0IG1lcm1haWREZWYgPSBlbG0uaW5uZXJUZXh0OwogICAgICAgIGNvbnN0IG1tRWxtID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7CiAgICAgICAgbW1FbG0uaW5uZXJIVE1MID0gYDxkaXYgaWQ9Im1lcm1haWQtaWQtJHttZXJtYWlkSWR9Ij4ke21lcm1haWQucmVuZGVyKGBtZXJtYWlkLWlkLSR7bWVybWFpZElkfWAsIG1lcm1haWREZWYpfTwvZGl2PmA7CiAgICAgICAgZWxtLnBhcmVudEVsZW1lbnQucmVwbGFjZVdpdGgobW1FbG0pOwogICAgICB9KTsKICAgIH0sCgogICAgYXV0b2NvbXBsZXRlKGNtLCBjaGFuZ2UpIHsKICAgICAgaWYgKGNtLmdldE1vZGVBdChjbS5nZXRDdXJzb3IoKSkubmFtZSAhPT0gJ21hcmtkb3duJykgewogICAgICAgIHJldHVybjsKICAgICAgfSAvLyBMaW5rcwoKCiAgICAgIGlmIChjaGFuZ2UudGV4dFswXSA9PT0gJygnKSB7CiAgICAgICAgY29uc3QgY3VyTGluZSA9IGNtLmdldExpbmUoY2hhbmdlLmZyb20ubGluZSkuc3Vic3RyaW5nKDAsIGNoYW5nZS5mcm9tLmNoKTsKCiAgICAgICAgaWYgKGN1ckxpbmVbY3VyTGluZS5sZW5ndGggLSAxXSA9PT0gJ10nKSB7CiAgICAgICAgICBjbS5zaG93SGludCh7CiAgICAgICAgICAgIGhpbnQ6IGFzeW5jIChjbSwgb3B0aW9ucykgPT4gewogICAgICAgICAgICAgIGNvbnN0IGN1ciA9IGNtLmdldEN1cnNvcigpOwogICAgICAgICAgICAgIGNvbnN0IGN1ckxpbmUgPSBjbS5nZXRMaW5lKGN1ci5saW5lKS5zdWJzdHJpbmcoMCwgY3VyLmNoKTsKICAgICAgICAgICAgICBjb25zdCBxdWVyeVN0cmluZyA9IGN1ckxpbmUuc3Vic3RyaW5nKGN1ckxpbmUubGFzdEluZGV4T2YoJ1snKSArIDEsIGN1ckxpbmUubGVuZ3RoIC0gMik7CiAgICAgICAgICAgICAgY29uc3QgdG9rZW4gPSBjbS5nZXRUb2tlbkF0KGN1cik7CgogICAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICBjb25zdCByZXNwUmF3ID0gYXdhaXQgdGhpcy4kYXBvbGxvLnF1ZXJ5KHsKICAgICAgICAgICAgICAgICAgcXVlcnk6IHsKICAgICAgICAgICAgICAgICAgICAia2luZCI6ICJEb2N1bWVudCIsCiAgICAgICAgICAgICAgICAgICAgImRlZmluaXRpb25zIjogW3sKICAgICAgICAgICAgICAgICAgICAgICJraW5kIjogIk9wZXJhdGlvbkRlZmluaXRpb24iLAogICAgICAgICAgICAgICAgICAgICAgIm9wZXJhdGlvbiI6ICJxdWVyeSIsCiAgICAgICAgICAgICAgICAgICAgICAidmFyaWFibGVEZWZpbml0aW9ucyI6IFt7CiAgICAgICAgICAgICAgICAgICAgICAgICJraW5kIjogIlZhcmlhYmxlRGVmaW5pdGlvbiIsCiAgICAgICAgICAgICAgICAgICAgICAgICJ2YXJpYWJsZSI6IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAia2luZCI6ICJWYXJpYWJsZSIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgIm5hbWUiOiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAia2luZCI6ICJOYW1lIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICJ2YWx1ZSI6ICJxdWVyeSIKICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgICAgICJ0eXBlIjogewogICAgICAgICAgICAgICAgICAgICAgICAgICJraW5kIjogIk5vbk51bGxUeXBlIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAidHlwZSI6IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICJraW5kIjogIk5hbWVkVHlwZSIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAibmFtZSI6IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgImtpbmQiOiAiTmFtZSIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICJ2YWx1ZSI6ICJTdHJpbmciCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgICAgICAiZGlyZWN0aXZlcyI6IFtdCiAgICAgICAgICAgICAgICAgICAgICB9LCB7CiAgICAgICAgICAgICAgICAgICAgICAgICJraW5kIjogIlZhcmlhYmxlRGVmaW5pdGlvbiIsCiAgICAgICAgICAgICAgICAgICAgICAgICJ2YXJpYWJsZSI6IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAia2luZCI6ICJWYXJpYWJsZSIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgIm5hbWUiOiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAia2luZCI6ICJOYW1lIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICJ2YWx1ZSI6ICJsb2NhbGUiCiAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgICAgICAidHlwZSI6IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAia2luZCI6ICJOYW1lZFR5cGUiLAogICAgICAgICAgICAgICAgICAgICAgICAgICJuYW1lIjogewogICAgICAgICAgICAgICAgICAgICAgICAgICAgImtpbmQiOiAiTmFtZSIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAidmFsdWUiOiAiU3RyaW5nIgogICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICAgICAgImRpcmVjdGl2ZXMiOiBbXQogICAgICAgICAgICAgICAgICAgICAgfV0sCiAgICAgICAgICAgICAgICAgICAgICAiZGlyZWN0aXZlcyI6IFtdLAogICAgICAgICAgICAgICAgICAgICAgInNlbGVjdGlvblNldCI6IHsKICAgICAgICAgICAgICAgICAgICAgICAgImtpbmQiOiAiU2VsZWN0aW9uU2V0IiwKICAgICAgICAgICAgICAgICAgICAgICAgInNlbGVjdGlvbnMiOiBbewogICAgICAgICAgICAgICAgICAgICAgICAgICJraW5kIjogIkZpZWxkIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAibmFtZSI6IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICJraW5kIjogIk5hbWUiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgInZhbHVlIjogInBhZ2VzIgogICAgICAgICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgICAgICAgImFyZ3VtZW50cyI6IFtdLAogICAgICAgICAgICAgICAgICAgICAgICAgICJkaXJlY3RpdmVzIjogW10sCiAgICAgICAgICAgICAgICAgICAgICAgICAgInNlbGVjdGlvblNldCI6IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICJraW5kIjogIlNlbGVjdGlvblNldCIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAic2VsZWN0aW9ucyI6IFt7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICJraW5kIjogIkZpZWxkIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIm5hbWUiOiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgImtpbmQiOiAiTmFtZSIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgInZhbHVlIjogInNlYXJjaCIKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgImFyZ3VtZW50cyI6IFt7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgImtpbmQiOiAiQXJndW1lbnQiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICJuYW1lIjogewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgImtpbmQiOiAiTmFtZSIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAidmFsdWUiOiAicXVlcnkiCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAidmFsdWUiOiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAia2luZCI6ICJWYXJpYWJsZSIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAibmFtZSI6IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgImtpbmQiOiAiTmFtZSIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICJ2YWx1ZSI6ICJxdWVyeSIKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAia2luZCI6ICJBcmd1bWVudCIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIm5hbWUiOiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAia2luZCI6ICJOYW1lIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICJ2YWx1ZSI6ICJsb2NhbGUiCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAidmFsdWUiOiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAia2luZCI6ICJWYXJpYWJsZSIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAibmFtZSI6IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgImtpbmQiOiAiTmFtZSIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICJ2YWx1ZSI6ICJsb2NhbGUiCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgImRpcmVjdGl2ZXMiOiBbXSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgInNlbGVjdGlvblNldCI6IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAia2luZCI6ICJTZWxlY3Rpb25TZXQiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICJzZWxlY3Rpb25zIjogW3sKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICJraW5kIjogIkZpZWxkIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICJuYW1lIjogewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAia2luZCI6ICJOYW1lIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgInZhbHVlIjogInJlc3VsdHMiCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgImFyZ3VtZW50cyI6IFtdLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgImRpcmVjdGl2ZXMiOiBbXSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICJzZWxlY3Rpb25TZXQiOiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICJraW5kIjogIlNlbGVjdGlvblNldCIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICJzZWxlY3Rpb25zIjogW3sKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAia2luZCI6ICJGaWVsZCIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIm5hbWUiOiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAia2luZCI6ICJOYW1lIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICJ2YWx1ZSI6ICJ0aXRsZSIKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICJhcmd1bWVudHMiOiBbXSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAiZGlyZWN0aXZlcyI6IFtdCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAia2luZCI6ICJGaWVsZCIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIm5hbWUiOiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAia2luZCI6ICJOYW1lIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICJ2YWx1ZSI6ICJwYXRoIgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgImFyZ3VtZW50cyI6IFtdLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICJkaXJlY3RpdmVzIjogW10KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSwgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICJraW5kIjogIkZpZWxkIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAibmFtZSI6IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICJraW5kIjogIk5hbWUiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgInZhbHVlIjogImxvY2FsZSIKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICJhcmd1bWVudHMiOiBbXSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAiZGlyZWN0aXZlcyI6IFtdCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1dCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSwgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgImtpbmQiOiAiRmllbGQiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIm5hbWUiOiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICJraW5kIjogIk5hbWUiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAidmFsdWUiOiAidG90YWxIaXRzIgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICJhcmd1bWVudHMiOiBbXSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICJkaXJlY3RpdmVzIjogW10KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XQogICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgfV0KICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9XSwKICAgICAgICAgICAgICAgICAgICAibG9jIjogewogICAgICAgICAgICAgICAgICAgICAgInN0YXJ0IjogMCwKICAgICAgICAgICAgICAgICAgICAgICJlbmQiOiA0NDksCiAgICAgICAgICAgICAgICAgICAgICAic291cmNlIjogewogICAgICAgICAgICAgICAgICAgICAgICAiYm9keSI6ICJcbiAgICAgICAgICAgICAgICAgICAgcXVlcnkgKCRxdWVyeTogU3RyaW5nISwgJGxvY2FsZTogU3RyaW5nKSB7XG4gICAgICAgICAgICAgICAgICAgICAgcGFnZXMge1xuICAgICAgICAgICAgICAgICAgICAgICAgc2VhcmNoKHF1ZXJ5OiRxdWVyeSwgbG9jYWxlOiRsb2NhbGUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgcmVzdWx0cyB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGl0bGVcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwYXRoXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbG9jYWxlXG4gICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgdG90YWxIaXRzXG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAiLAogICAgICAgICAgICAgICAgICAgICAgICAibmFtZSI6ICJHcmFwaFFMIHJlcXVlc3QiLAogICAgICAgICAgICAgICAgICAgICAgICAibG9jYXRpb25PZmZzZXQiOiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgImxpbmUiOiAxLAogICAgICAgICAgICAgICAgICAgICAgICAgICJjb2x1bW4iOiAxCiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgIHZhcmlhYmxlczogewogICAgICAgICAgICAgICAgICAgIHF1ZXJ5OiBxdWVyeVN0cmluZywKICAgICAgICAgICAgICAgICAgICBsb2NhbGU6IHRoaXMubG9jYWxlCiAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgIGZldGNoUG9saWN5OiAnY2FjaGUtZmlyc3QnCiAgICAgICAgICAgICAgICB9KTsKCiAgICAgICAgICAgICAgICBjb25zdCByZXNwID0gX2dldChyZXNwUmF3LCAnZGF0YS5wYWdlcy5zZWFyY2gnLCB7fSk7CgogICAgICAgICAgICAgICAgaWYgKHJlc3AgJiYgcmVzcC50b3RhbEhpdHMgPiAwKSB7CiAgICAgICAgICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICAgICAgICAgbGlzdDogcmVzcC5yZXN1bHRzLm1hcChyID0+ICh7CiAgICAgICAgICAgICAgICAgICAgICB0ZXh0OiAnKCcgKyAoc2l0ZUxhbmdzLmxlbmd0aCA+IDAgPyBgLyR7ci5sb2NhbGV9LyR7ci5wYXRofWAgOiBgLyR7ci5wYXRofWApICsgJyknLAogICAgICAgICAgICAgICAgICAgICAgZGlzcGxheVRleHQ6IHNpdGVMYW5ncy5sZW5ndGggPiAwID8gYC8ke3IubG9jYWxlfS8ke3IucGF0aH0gLSAke3IudGl0bGV9YCA6IGAvJHtyLnBhdGh9IC0gJHtyLnRpdGxlfWAKICAgICAgICAgICAgICAgICAgICB9KSksCiAgICAgICAgICAgICAgICAgICAgZnJvbTogQ29kZU1pcnJvci5Qb3MoY3VyLmxpbmUsIHRva2VuLnN0YXJ0KSwKICAgICAgICAgICAgICAgICAgICB0bzogQ29kZU1pcnJvci5Qb3MoY3VyLmxpbmUsIHRva2VuLmVuZCkKICAgICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9IGNhdGNoIChlcnIpIHt9CgogICAgICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICAgICBsaXN0OiBbXSwKICAgICAgICAgICAgICAgIGZyb206IENvZGVNaXJyb3IuUG9zKGN1ci5saW5lLCB0b2tlbi5zdGFydCksCiAgICAgICAgICAgICAgICB0bzogQ29kZU1pcnJvci5Qb3MoY3VyLmxpbmUsIHRva2VuLmVuZCkKICAgICAgICAgICAgICB9OwogICAgICAgICAgICB9CiAgICAgICAgICB9KTsKICAgICAgICB9CiAgICAgIH0KICAgIH0sCgogICAgaW5zZXJ0TGluaygpIHsKICAgICAgdGhpcy5pbnNlcnRMaW5rRGlhbG9nID0gdHJ1ZTsKICAgIH0sCgogICAgaW5zZXJ0TGlua0hhbmRsZXIoewogICAgICBsb2NhbGUsCiAgICAgIHBhdGgKICAgIH0pIHsKICAgICAgY29uc3QgbGFzdFBhcnQgPSBfbGFzdChwYXRoLnNwbGl0KCcvJykpOwoKICAgICAgdGhpcy5pbnNlcnRBdEN1cnNvcih7CiAgICAgICAgY29udGVudDogc2l0ZUxhbmdzLmxlbmd0aCA+IDAgPyBgWyR7bGFzdFBhcnR9XSgvJHtsb2NhbGV9LyR7cGF0aH0pYCA6IGBbJHtsYXN0UGFydH1dKC8ke3BhdGh9KWAKICAgICAgfSk7CiAgICB9LAoKICAgIHByb2Nlc3NNYXJrZXJzKGZyb20sIHRvKSB7CiAgICAgIGxldCBmb3VuZCA9IG51bGw7CiAgICAgIGxldCBmb3VuZFN0YXJ0ID0gMDsKICAgICAgdGhpcy5jbS5kb2MuZ2V0QWxsTWFya3MoKS5mb3JFYWNoKG1rID0+IHsKICAgICAgICBpZiAobWsuX19raW5kKSB7CiAgICAgICAgICBtay5jbGVhcigpOwogICAgICAgIH0KICAgICAgfSk7CiAgICAgIHRoaXMuY20uZWFjaExpbmUoZnJvbSwgdG8sIGxuID0+IHsKICAgICAgICBjb25zdCBsaW5lID0gbG4ubGluZU5vKCk7CgogICAgICAgIGlmIChsbi50ZXh0LnN0YXJ0c1dpdGgoJ2BgYGRpYWdyYW0nKSkgewogICAgICAgICAgZm91bmQgPSAnZGlhZ3JhbSc7CiAgICAgICAgICBmb3VuZFN0YXJ0ID0gbGluZTsKICAgICAgICB9IGVsc2UgaWYgKGxuLnRleHQgPT09ICdgYGAnICYmIGZvdW5kKSB7CiAgICAgICAgICBzd2l0Y2ggKGZvdW5kKSB7CiAgICAgICAgICAgIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgICAgICAgICAvLyAtPiBESUFHUkFNCiAgICAgICAgICAgIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgICAgICAgICBjYXNlICdkaWFncmFtJzoKICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICBpZiAobGluZSAtIGZvdW5kU3RhcnQgIT09IDIpIHsKICAgICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIHRoaXMuYWRkTWFya2VyKHsKICAgICAgICAgICAgICAgICAga2luZDogJ2RpYWdyYW0nLAogICAgICAgICAgICAgICAgICBmcm9tOiB7CiAgICAgICAgICAgICAgICAgICAgbGluZTogZm91bmRTdGFydCwKICAgICAgICAgICAgICAgICAgICBjaDogMwogICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICB0bzogewogICAgICAgICAgICAgICAgICAgIGxpbmU6IGZvdW5kU3RhcnQsCiAgICAgICAgICAgICAgICAgICAgY2g6IDEwCiAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgIHRleHQ6ICdFZGl0IERpYWdyYW0nLAogICAgICAgICAgICAgICAgICBhY3Rpb246ICgoc3RhcnQsIGVuZCkgPT4gewogICAgICAgICAgICAgICAgICAgIHJldHVybiBldiA9PiB7CiAgICAgICAgICAgICAgICAgICAgICB0aGlzLmNtLmRvYy5zZXRTZWxlY3Rpb24oewogICAgICAgICAgICAgICAgICAgICAgICBsaW5lOiBzdGFydCwKICAgICAgICAgICAgICAgICAgICAgICAgY2g6IDAKICAgICAgICAgICAgICAgICAgICAgIH0sIHsKICAgICAgICAgICAgICAgICAgICAgICAgbGluZTogZW5kLAogICAgICAgICAgICAgICAgICAgICAgICBjaDogMwogICAgICAgICAgICAgICAgICAgICAgfSk7CgogICAgICAgICAgICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgcmF3ID0gdGhpcy5jbS5kb2MuZ2V0TGluZShlbmQgLSAxKTsKICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy4kc3RvcmUuc2V0KCdlZGl0b3IvYWN0aXZlTW9kYWxEYXRhJywgQnVmZmVyLmZyb20ocmF3LCAnYmFzZTY0JykudG9TdHJpbmcoKSk7CiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMudG9nZ2xlTW9kYWwoYGVkaXRvck1vZGFsRHJhd2lvYCk7CiAgICAgICAgICAgICAgICAgICAgICB9IGNhdGNoIChlcnIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuJHN0b3JlLmNvbW1pdCgnc2hvd05vdGlmaWNhdGlvbicsIHsKICAgICAgICAgICAgICAgICAgICAgICAgICBtZXNzYWdlOiAnRmFpbGVkIHRvIHByb2Nlc3MgZGlhZ3JhbSBkYXRhLicsCiAgICAgICAgICAgICAgICAgICAgICAgICAgc3R5bGU6ICd3YXJuaW5nJywKICAgICAgICAgICAgICAgICAgICAgICAgICBpY29uOiAnd2FybmluZycKICAgICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICAgICAgfSkoZm91bmRTdGFydCwgbGluZSkKICAgICAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgICAgIGlmIChsbi5oZWlnaHQgPiAwKSB7CiAgICAgICAgICAgICAgICAgIHRoaXMuY20uZm9sZENvZGUoZm91bmRTdGFydCk7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgfQogICAgICAgICAgfQoKICAgICAgICAgIGZvdW5kID0gbnVsbDsKICAgICAgICB9CiAgICAgIH0pOwogICAgfSwKCiAgICBhZGRNYXJrZXIoewogICAgICBraW5kLAogICAgICBmcm9tLAogICAgICB0bywKICAgICAgdGV4dCwKICAgICAgYWN0aW9uCiAgICB9KSB7CiAgICAgIGNvbnN0IG1hcmtlckVsbSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3NwYW4nKTsKICAgICAgbWFya2VyRWxtLmFwcGVuZENoaWxkKGRvY3VtZW50LmNyZWF0ZVRleHROb2RlKHRleHQpKTsKICAgICAgbWFya2VyRWxtLmNsYXNzTmFtZSA9ICdDb2RlTWlycm9yLWJ1dHRvbm1hcmtlcic7CiAgICAgIG1hcmtlckVsbS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIGFjdGlvbik7CiAgICAgIHRoaXMuY20ubWFya1RleHQoZnJvbSwgdG8sIHsKICAgICAgICByZXBsYWNlZFdpdGg6IG1hcmtlckVsbSwKICAgICAgICBfX2tpbmQ6IGtpbmQKICAgICAgfSk7CiAgICB9CgogIH0sCgogIG1vdW50ZWQoKSB7CiAgICB0aGlzLiRzdG9yZS5zZXQoJ2VkaXRvci9lZGl0b3JLZXknLCAnbWFya2Rvd24nKTsKCiAgICBpZiAodGhpcy5tb2RlID09PSAnY3JlYXRlJyAmJiAhdGhpcy4kc3RvcmUuZ2V0KCdlZGl0b3IvY29udGVudCcpKSB7CiAgICAgIHRoaXMuJHN0b3JlLnNldCgnZWRpdG9yL2NvbnRlbnQnLCAnIyBIZWFkZXJcbllvdXIgY29udGVudCBoZXJlJyk7CiAgICB9IC8vIEluaXRpYWxpemUgTWVybWFpZCBBUEkKCgogICAgbWVybWFpZC5pbml0aWFsaXplKHsKICAgICAgc3RhcnRPbkxvYWQ6IGZhbHNlLAogICAgICB0aGVtZTogdGhpcy4kdnVldGlmeS50aGVtZS5kYXJrID8gYGRhcmtgIDogYGRlZmF1bHRgCiAgICB9KTsgLy8gSW5pdGlhbGl6ZSBDb2RlTWlycm9yCgogICAgdGhpcy5jbSA9IENvZGVNaXJyb3IuZnJvbVRleHRBcmVhKHRoaXMuJHJlZnMuY20sIHsKICAgICAgdGFiU2l6ZTogMiwKICAgICAgbW9kZTogJ3RleHQvbWFya2Rvd24nLAogICAgICB0aGVtZTogJ3dpa2lqcy1kYXJrJywKICAgICAgbGluZU51bWJlcnM6IHRydWUsCiAgICAgIGxpbmVXcmFwcGluZzogdHJ1ZSwKICAgICAgbGluZTogdHJ1ZSwKICAgICAgc3R5bGVBY3RpdmVMaW5lOiB0cnVlLAogICAgICBoaWdobGlnaHRTZWxlY3Rpb25NYXRjaGVzOiB7CiAgICAgICAgYW5ub3RhdGVTY3JvbGxiYXI6IHRydWUKICAgICAgfSwKICAgICAgdmlld3BvcnRNYXJnaW46IDUwLAogICAgICBpbnB1dFN0eWxlOiAnY29udGVudGVkaXRhYmxlJywKICAgICAgYWxsb3dEcm9wRmlsZVR5cGVzOiBbJ2ltYWdlL2pwZycsICdpbWFnZS9wbmcnLCAnaW1hZ2Uvc3ZnJywgJ2ltYWdlL2pwZWcnLCAnaW1hZ2UvZ2lmJ10sCiAgICAgIGRpcmVjdGlvbjogc2l0ZUNvbmZpZy5ydGwgPyAncnRsJyA6ICdsdHInLAogICAgICBmb2xkR3V0dGVyOiB0cnVlLAogICAgICBndXR0ZXJzOiBbJ0NvZGVNaXJyb3ItbGluZW51bWJlcnMnLCAnQ29kZU1pcnJvci1mb2xkZ3V0dGVyJ10KICAgIH0pOwogICAgdGhpcy5jbS5zZXRWYWx1ZSh0aGlzLiRzdG9yZS5nZXQoJ2VkaXRvci9jb250ZW50JykpOwogICAgdGhpcy5jbS5vbignY2hhbmdlJywgYyA9PiB7CiAgICAgIHRoaXMuJHN0b3JlLnNldCgnZWRpdG9yL2NvbnRlbnQnLCBjLmdldFZhbHVlKCkpOwogICAgICB0aGlzLm9uQ21JbnB1dCh0aGlzLiRzdG9yZS5nZXQoJ2VkaXRvci9jb250ZW50JykpOwogICAgfSk7CgogICAgaWYgKHRoaXMuJHZ1ZXRpZnkuYnJlYWtwb2ludC5tZEFuZFVwKSB7CiAgICAgIHRoaXMuY20uc2V0U2l6ZShudWxsLCAnY2FsYygxMDB2aCAtIDExMnB4IC0gMjRweCknKTsKICAgIH0gZWxzZSB7CiAgICAgIHRoaXMuY20uc2V0U2l6ZShudWxsLCAnY2FsYygxMDB2aCAtIDExMnB4IC0gMTZweCknKTsKICAgIH0gLy8gU2V0IEtleWJpbmRpbmdzCgoKICAgIGNvbnN0IGtleUJpbmRpbmdzID0gewogICAgICAnRjExJyhjKSB7CiAgICAgICAgYy5zZXRPcHRpb24oJ2Z1bGxTY3JlZW4nLCAhYy5nZXRPcHRpb24oJ2Z1bGxTY3JlZW4nKSk7CiAgICAgIH0sCgogICAgICAnRXNjJyhjKSB7CiAgICAgICAgaWYgKGMuZ2V0T3B0aW9uKCdmdWxsU2NyZWVuJykpIGMuc2V0T3B0aW9uKCdmdWxsU2NyZWVuJywgZmFsc2UpOwogICAgICB9CgogICAgfTsKCiAgICBfc2V0KGtleUJpbmRpbmdzLCBgJHtDdHJsS2V5fS1TYCwgYyA9PiB7CiAgICAgIHRoaXMuc2F2ZSgpOwogICAgICByZXR1cm4gZmFsc2U7CiAgICB9KTsKCiAgICBfc2V0KGtleUJpbmRpbmdzLCBgJHtDdHJsS2V5fS1CYCwgYyA9PiB7CiAgICAgIHRoaXMudG9nZ2xlTWFya3VwKHsKICAgICAgICBzdGFydDogYCoqYAogICAgICB9KTsKICAgICAgcmV0dXJuIGZhbHNlOwogICAgfSk7CgogICAgX3NldChrZXlCaW5kaW5ncywgYCR7Q3RybEtleX0tSWAsIGMgPT4gewogICAgICB0aGlzLnRvZ2dsZU1hcmt1cCh7CiAgICAgICAgc3RhcnQ6IGAqYAogICAgICB9KTsKICAgICAgcmV0dXJuIGZhbHNlOwogICAgfSk7CgogICAgX3NldChrZXlCaW5kaW5ncywgYCR7Q3RybEtleX0tQWx0LVJpZ2h0YCwgYyA9PiB7CiAgICAgIGxldCBsdmwgPSB0aGlzLmdldEhlYWRlckxldmVsKGMpOwoKICAgICAgaWYgKGx2bCA+PSA2KSB7CiAgICAgICAgbHZsID0gNTsKICAgICAgfQoKICAgICAgdGhpcy5zZXRIZWFkZXJMaW5lKGx2bCArIDEpOwogICAgICByZXR1cm4gZmFsc2U7CiAgICB9KTsKCiAgICBfc2V0KGtleUJpbmRpbmdzLCBgJHtDdHJsS2V5fS1BbHQtTGVmdGAsIGMgPT4gewogICAgICBsZXQgbHZsID0gdGhpcy5nZXRIZWFkZXJMZXZlbChjKTsKCiAgICAgIGlmIChsdmwgPD0gMSkgewogICAgICAgIGx2bCA9IDI7CiAgICAgIH0KCiAgICAgIHRoaXMuc2V0SGVhZGVyTGluZShsdmwgLSAxKTsKICAgICAgcmV0dXJuIGZhbHNlOwogICAgfSk7CgogICAgdGhpcy5jbS5zZXRPcHRpb24oJ2V4dHJhS2V5cycsIGtleUJpbmRpbmdzKTsKICAgIHRoaXMuY20ub24oJ2lucHV0UmVhZCcsIHRoaXMuYXV0b2NvbXBsZXRlKTsgLy8gSGFuZGxlIGN1cnNvciBtb3ZlbWVudAoKICAgIHRoaXMuY20ub24oJ2N1cnNvckFjdGl2aXR5JywgYyA9PiB7CiAgICAgIHRoaXMucG9zaXRpb25TeW5jKGMpOwogICAgICB0aGlzLnNjcm9sbFN5bmMoYyk7CiAgICB9KTsgLy8gSGFuZGxlIHNwZWNpYWwgcGFzdGUKCiAgICB0aGlzLmNtLm9uKCdwYXN0ZScsIHRoaXMub25DbVBhc3RlKTsgLy8gUmVuZGVyIGluaXRpYWwgcHJldmlldwoKICAgIHRoaXMucHJvY2Vzc0NvbnRlbnQodGhpcy4kc3RvcmUuZ2V0KCdlZGl0b3IvY29udGVudCcpKTsKICAgIHRoaXMucmVmcmVzaCgpOwogICAgdGhpcy4kcm9vdC4kb24oJ2VkaXRvckluc2VydCcsIG9wdHMgPT4gewogICAgICBzd2l0Y2ggKG9wdHMua2luZCkgewogICAgICAgIGNhc2UgJ0lNQUdFJzoKICAgICAgICAgIGxldCBpbWcgPSBgIVske29wdHMudGV4dH1dKCR7b3B0cy5wYXRofSlgOwoKICAgICAgICAgIGlmIChvcHRzLmFsaWduICYmIG9wdHMuYWxpZ24gIT09ICcnKSB7CiAgICAgICAgICAgIGltZyArPSBgey5hbGlnbi0ke29wdHMuYWxpZ259fWA7CiAgICAgICAgICB9CgogICAgICAgICAgdGhpcy5pbnNlcnRBdEN1cnNvcih7CiAgICAgICAgICAgIGNvbnRlbnQ6IGltZwogICAgICAgICAgfSk7CiAgICAgICAgICBicmVhazsKCiAgICAgICAgY2FzZSAnQklOQVJZJzoKICAgICAgICAgIHRoaXMuaW5zZXJ0QXRDdXJzb3IoewogICAgICAgICAgICBjb250ZW50OiBgWyR7b3B0cy50ZXh0fV0oJHtvcHRzLnBhdGh9KWAKICAgICAgICAgIH0pOwogICAgICAgICAgYnJlYWs7CgogICAgICAgIGNhc2UgJ0RJQUdSQU0nOgogICAgICAgICAgY29uc3Qgc2VsU3RhcnRMaW5lID0gdGhpcy5jbS5nZXRDdXJzb3IoJ2Zyb20nKS5saW5lOwogICAgICAgICAgY29uc3Qgc2VsRW5kTGluZSA9IHRoaXMuY20uZ2V0Q3Vyc29yKCd0bycpLmxpbmUgKyAxOwogICAgICAgICAgdGhpcy5jbS5kb2MucmVwbGFjZVNlbGVjdGlvbignYGBgZGlhZ3JhbVxuJyArIG9wdHMudGV4dCArICdcbmBgYFxuJywgJ3N0YXJ0Jyk7CiAgICAgICAgICB0aGlzLnByb2Nlc3NNYXJrZXJzKHNlbFN0YXJ0TGluZSwgc2VsRW5kTGluZSk7CiAgICAgICAgICBicmVhazsKICAgICAgfQogICAgfSk7IC8vIEhhbmRsZSBzYXZlIGNvbmZsaWN0CgogICAgdGhpcy4kcm9vdC4kb24oJ3NhdmVDb25mbGljdCcsICgpID0+IHsKICAgICAgdGhpcy50b2dnbGVNb2RhbChgZWRpdG9yTW9kYWxDb25mbGljdGApOwogICAgfSk7CiAgICB0aGlzLiRyb290LiRvbignb3ZlcndyaXRlRWRpdG9yQ29udGVudCcsICgpID0+IHsKICAgICAgdGhpcy5jbS5zZXRWYWx1ZSh0aGlzLiRzdG9yZS5nZXQoJ2VkaXRvci9jb250ZW50JykpOwogICAgfSk7CiAgfSwKCiAgYmVmb3JlRGVzdHJveSgpIHsKICAgIHRoaXMuJHJvb3QuJG9mZignZWRpdG9ySW5zZXJ0Jyk7CiAgfQoKfTs="},null]}